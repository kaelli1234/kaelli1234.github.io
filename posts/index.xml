<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Kael Li</title>
        <link>/posts/</link>
        <description>Recent content in Posts on Kael Li</description>
        <generator>Hugo -- gohugo.io</generator>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Thu, 08 Nov 2018 00:00:00 +0000</lastBuildDate>
        <atom:link href="/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>MySQLæŸ¥è¯¢ä¼˜åŒ–ä¹‹å»¶è¿Ÿå…³è”</title>
            <link>/posts/2018/11/08/mysql-deferred-join/</link>
            <pubDate>Thu, 08 Nov 2018 00:00:00 +0000</pubDate>
            
            <guid>/posts/2018/11/08/mysql-deferred-join/</guid>
            <description>æœ€è¿‘é¡¹ç›®ä¸Šé‡åˆ°äº†ç”±äºä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„ä¸šåŠ¡å¯¼è‡´è¯·æ±‚è¶…æ—¶ï¼Œé¡µé¢æ— æ³•æ­£å¸¸æ˜¾ç¤ºçš„æƒ…å†µã€‚åˆ†æè§£å†³é—®é¢˜åï¼Œè®°å½•ä¸‹å¤‡å¿˜ã€‚
 ç®€å•æè¿°ä¸‹ä¸šåŠ¡ï¼Œæ˜¯ä¸€å¼ ç”¨æ¥è®°å½•ç”¨æˆ·æ“ä½œè¡Œä¸ºçš„è¡¨ï¼Œæ•°æ®é‡å¤§æ¦‚åœ¨1500Wå·¦å³ã€‚å‰ç«¯ç”¨æˆ·é€šè¿‡é€‰æ‹©ç±»å‹ï¼Œæ—¶é—´ç­‰ç­›é€‰ï¼Œå¾—åˆ°åˆ†é¡µç»“æœã€‚
 è¡¨ç»“æ„å¦‚ä¸‹
| t_operate_6 | CREATE TABLE `t_operate_6` ( `Fid` int(11) unsigned NOT NULL AUTO_INCREMENT, `Fcid` bigint(20) unsigned NOT NULL, `Fuid` bigint(20) unsigned NOT NULL, `Fname` varchar(32) DEFAULT NULL, `FroleName` varchar(64) NOT NULL, `Faction` int(2) NOT NULL, `FobjectId` varchar(64) DEFAULT NULL, `FobjectName` varchar(64) DEFAULT NULL, `Fip` varchar(64) DEFAULT NULL, `Fdevtype` int(2) NOT NULL DEFAULT &#39;0&#39;, `Fctime` int(11) unsigned NOT NULL, PRIMARY KEY (`Fid`), KEY `Fcid` (`Fcid`), KEY `Fuid` (`Fuid`), KEY `Fctime` (`Fctime`), ) ENGINE=InnoDB AUTO_INCREMENT=14491762 DEFAULT CHARSET=utf8 |   ä¸šåŠ¡å…¶å®å¹¶ä¸å¤æ‚ï¼ŒåŸæ¥çš„å®ç°é€»è¾‘åŸºæœ¬åŸºäºä»¥ä¸‹ä¿©æ¡SQLè¯­å¥ã€‚ï¼ˆä»¥ä¸‹æ•°æ®åŸºäºæœ¬åœ°æµ‹è¯•åº“ï¼Œæ·»åŠ äº†SQL_NO_CACHEæ¡ä»¶é¿å…æŸ¥è¯¢è¯­å¥è¢«ç¼“å­˜ï¼‰</description>
            <content type="html"><![CDATA[

<p>æœ€è¿‘é¡¹ç›®ä¸Šé‡åˆ°äº†ç”±äºä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢çš„ä¸šåŠ¡å¯¼è‡´è¯·æ±‚è¶…æ—¶ï¼Œé¡µé¢æ— æ³•æ­£å¸¸æ˜¾ç¤ºçš„æƒ…å†µã€‚åˆ†æè§£å†³é—®é¢˜åï¼Œè®°å½•ä¸‹å¤‡å¿˜ã€‚</p>

<blockquote>
<p>ç®€å•æè¿°ä¸‹ä¸šåŠ¡ï¼Œæ˜¯ä¸€å¼ ç”¨æ¥è®°å½•ç”¨æˆ·æ“ä½œè¡Œä¸ºçš„è¡¨ï¼Œæ•°æ®é‡å¤§æ¦‚åœ¨1500Wå·¦å³ã€‚å‰ç«¯ç”¨æˆ·é€šè¿‡é€‰æ‹©ç±»å‹ï¼Œæ—¶é—´ç­‰ç­›é€‰ï¼Œå¾—åˆ°åˆ†é¡µç»“æœã€‚</p>
</blockquote>

<p>è¡¨ç»“æ„å¦‚ä¸‹</p>

<pre><code>| t_operate_6 | CREATE TABLE `t_operate_6` (
  `Fid` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `Fcid` bigint(20) unsigned NOT NULL,
  `Fuid` bigint(20) unsigned NOT NULL,
  `Fname` varchar(32) DEFAULT NULL,
  `FroleName` varchar(64) NOT NULL,
  `Faction` int(2) NOT NULL,
  `FobjectId` varchar(64) DEFAULT NULL,
  `FobjectName` varchar(64) DEFAULT NULL,
  `Fip` varchar(64) DEFAULT NULL,
  `Fdevtype` int(2) NOT NULL DEFAULT '0',
  `Fctime` int(11) unsigned NOT NULL,
  PRIMARY KEY (`Fid`),
  KEY `Fcid` (`Fcid`),
  KEY `Fuid` (`Fuid`),
  KEY `Fctime` (`Fctime`),
) ENGINE=InnoDB AUTO_INCREMENT=14491762 DEFAULT CHARSET=utf8 |
</code></pre>

<blockquote>
<p>ä¸šåŠ¡å…¶å®å¹¶ä¸å¤æ‚ï¼ŒåŸæ¥çš„å®ç°é€»è¾‘åŸºæœ¬åŸºäºä»¥ä¸‹ä¿©æ¡SQLè¯­å¥ã€‚ï¼ˆ<strong>ä»¥ä¸‹æ•°æ®åŸºäºæœ¬åœ°æµ‹è¯•åº“ï¼Œæ·»åŠ äº†SQL_NO_CACHEæ¡ä»¶é¿å…æŸ¥è¯¢è¯­å¥è¢«ç¼“å­˜</strong>ï¼‰</p>
</blockquote>

<h4 id="æ ¹æ®æŸ¥è¯¢æ¡ä»¶å¾—åˆ°æ•°æ®æ€»æ•°-å‰ç«¯æ˜¾ç¤ºé¡µæ•°">æ ¹æ®æŸ¥è¯¢æ¡ä»¶å¾—åˆ°æ•°æ®æ€»æ•°ï¼ˆå‰ç«¯æ˜¾ç¤ºé¡µæ•°ï¼‰</h4>

<pre><code>mysql&gt; SELECT SQL_NO_CACHE COUNT(*) FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime;
+----------+
| count(*) |
+----------+
|   760611 |
+----------+
1 row in set (1.93 sec)
</code></pre>

<p>å¯ä»¥çœ‹åˆ°è™½ç„¶æ¢æˆäº†æœ¬åœ°æµ‹è¯•åº“åªæœ‰76Wæ¡æ•°æ®ï¼Œä¹Ÿè€—æ—¶äº†1.93ç§’ï¼Œä½¿ç”¨explainåˆ†æä¸‹SQLè¯­å¥ï¼Œå¦‚ä¸‹</p>

<pre><code>mysql&gt; EXPLAIN SELECT SQL_NO_CACHE COUNT(*) FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime;
+----+-------------+-------------+------+---------------+------+---------+-------+--------+------------------------------------+
| id | select_type | table       | type | possible_keys | key  | key_len | ref   | rows   | Extra                              |
+----+-------------+-------------+------+---------------+------+---------+-------+--------+------------------------------------+
|  1 | SIMPLE      | t_operate_0 | ref  | Fcid,Fctime   | Fcid | 8       | const | 156317 | Using index condition; Using where |
+----+-------------+-------------+------+---------------+------+---------+-------+--------+------------------------------------+
1 row in set (0.00 sec)
</code></pre>

<h4 id="ä¼˜åŒ–æ€è·¯">ä¼˜åŒ–æ€è·¯</h4>

<p>é€šè¿‡å»ºè¡¨è¯­å¥å¯ä»¥çœ‹åˆ°ï¼Œåªæ˜¯å•ç‹¬å¯¹Fcidã€Fctimeå»ºäº†ç´¢å¼•ã€‚å…¶å®é’ˆå¯¹ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œç›´æ¥å¯¹è¯¥å­—æ®µå»ºè”åˆç´¢å¼•å³å¯ã€‚<br/>
<strong>CREATE INDEX count ON t_operate_0 (Fcid, Fctime)</strong></p>

<p>å†çœ‹çœ‹æŸ¥è¯¢ç»“æœ</p>

<pre><code>mysql&gt; SELECT SQL_NO_CACHE COUNT(*) FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime;
+----------+
| COUNT(*) |
+----------+
|   760611 |
+----------+
1 row in set (0.62 sec)

mysql&gt; EXPLAIN SELECT SQL_NO_CACHE COUNT(*) FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime;
+----+-------------+-------------+-------+-------------------+-------+---------+------+--------+--------------------------+
| id | select_type | table       | type  | possible_keys     | key   | key_len | ref  | rows   | Extra                    |
+----+-------------+-------------+-------+-------------------+-------+---------+------+--------+--------------------------+
|  1 | SIMPLE      | t_operate_0 | range | Fcid,Fctime,count | count | 12      | NULL | 156317 | Using where; Using index |
+----+-------------+-------------+-------+-------------------+-------+---------+------+--------+--------------------------+
1 row in set (0.00 sec)
</code></pre>

<p>ç›´æ¥å‘½ä¸­äº†è”åˆç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦ä»<strong>1.93</strong>æé«˜åˆ°äº†<strong>0.62</strong>ã€‚é‚£è¿˜æœ‰æ²¡æœ‰å†ä¼˜åŒ–çš„ç©ºé—´å‘¢ï¼Ÿ<br/>
<strong>æˆ‘ä»¬ä»”ç»†åˆ†æä¸‹ä¸šåŠ¡ï¼Œå‰ç«¯åªéœ€è¦å¾—åˆ°æ•°æ®æ€»æ•°ã€‚å…¶å®å¯¹åº”è¡¨é‡Œå°±æœ‰è‡ªå¢çš„ä¸»é”®å­—æ®µï¼Œç›´æ¥è¿”å›è¯¥å­—æ®µçš„æœ€æ–°å€¼å³å¯</strong></p>

<pre><code>mysql&gt; SELECT SQL_NO_CACHE Fid FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime DESC LIMIT 1;
+--------+
| Fid    |
+--------+
| 762059 |
+--------+
1 row in set (0.01 sec)
</code></pre>

<p>ä»…0.01så°±è¿”å›äº†ç»“æœï¼è™½ç„¶æ•°å­—å’Œæ€»æ•°æœ‰äº›è®¸å‡ºå…¥ï¼Œä½†æ˜¯å…¶å®å¹¶ä¸å½±å“ä¸šåŠ¡ï¼æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹ä¸€æ¡è¯­å¥ã€‚</p>

<h4 id="æ ¹æ®æŸ¥è¯¢æ¡ä»¶å¾—åˆ°åˆ†é¡µæ•°æ®">æ ¹æ®æŸ¥è¯¢æ¡ä»¶å¾—åˆ°åˆ†é¡µæ•°æ®</h4>

<pre><code>mysql&gt; SELECT SQL_NO_CACHE * FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime DESC LIMIT 10000, 10;
10 rows in set (6.89 sec)

mysql&gt; EXPLAIN SELECT SQL_NO_CACHE * FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime DESC LIMIT 10000, 10;
+----+-------------+-------------+------+---------------+------+---------+-------+--------+----------------------------------------------------+
| id | select_type | table       | type | possible_keys | key  | key_len | ref   | rows   | Extra                                              |
+----+-------------+-------------+------+---------------+------+---------+-------+--------+----------------------------------------------------+
|  1 | SIMPLE      | t_operate_0 | ref  | Fcid,Fctime   | Fcid | 8       | const | 156317 | Using index condition; Using where; Using filesort |
+----+-------------+-------------+------+---------------+------+---------+-------+--------+----------------------------------------------------+
1 row in set (0.00 sec)
</code></pre>

<h4 id="ä¼˜åŒ–æ€è·¯-1">ä¼˜åŒ–æ€è·¯</h4>

<p>æ¡ä»¶åŸºæœ¬å’Œå–æ€»æ•°ä¸€è‡´ï¼Œåªæ˜¯å¤šlimitäº†è¯­å¥ï¼Œé¦–å…ˆè¿˜æ˜¯åº”è¯¥é€šè¿‡å»ºç«‹è”åˆç´¢å¼•è¦†ç›–æŸ¥è¯¢æ¡ä»¶(ä¸Šé¢å·²ç»å»ºå¥½)<br/>
ç”±äºlimitè¯­å¥çš„åŸå› ï¼Œmysqlå…¶å®è¿˜æ˜¯å…ˆæ‰«æäº†å‰10000æ¡æ•°æ®ï¼Œä¸¢å¼ƒåè¿”å›äº†éœ€è¦çš„10æ¡ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µ&lt;&lt;é«˜æ€§èƒ½MySQL&gt;&gt;ä¸­å…¶å®æœ‰æåˆ°è¿‡åˆ©ç”¨<strong>å»¶è¿Ÿå…³è”</strong>çš„æ–¹æ³•æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ä¼˜åŒ–åçš„SQLè¯­å¥å¦‚ä¸‹</p>

<pre><code>mysql&gt; SELECT SQL_NO_CACHE a.* FROM t_operate_0 a, (SELECT Fid FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime DESC LIMIT 10000, 10) b WHERE a.Fid = b.Fid;
10 rows in set (0.02 sec)

mysql&gt; EXPLAIN SELECT SQL_NO_CACHE a.* FROM t_operate_0 a, (SELECT Fid FROM t_operate_0 WHERE Fcid = 2111131044822780 AND Fctime &gt;= 1505171339 AND Fctime &lt;= 1542992406 ORDER BY Fctime DESC LIMIT 10000, 10) b WHERE a.Fid = b.Fid;
+----+-------------+-------------+--------+-------------------+---------+---------+-------+--------+--------------------------+
| id | select_type | table       | type   | possible_keys     | key     | key_len | ref   | rows   | Extra                    |
+----+-------------+-------------+--------+-------------------+---------+---------+-------+--------+--------------------------+
|  1 | PRIMARY     | &lt;derived2&gt;  | ALL    | NULL              | NULL    | NULL    | NULL  |  10010 | NULL                     |
|  1 | PRIMARY     | a           | eq_ref | PRIMARY           | PRIMARY | 4       | b.Fid |      1 | NULL                     |
|  2 | DERIVED     | t_operate_0 | range  | Fcid,Fctime,count | count   | 12      | NULL  | 156317 | Using where; Using index |
+----+-------------+-------------+--------+-------------------+---------+---------+-------+--------+--------------------------+
3 rows in set (0.00 sec)
</code></pre>

<p>é€šè¿‡å»ºç«‹è”åˆç´¢å¼•å’Œåˆ©ç”¨<strong>å»¶è¿Ÿå…³è”</strong>è°ƒæ•´SQLè¯­å¥ï¼ŒæŸ¥è¯¢æ—¶é—´ç›´æ¥ä»<strong>6.89s</strong>æå‡åˆ°äº†<strong>0.02s</strong>ï¼</p>

<h4 id="å…³äºå»¶è¿Ÿå…³è”">å…³äºå»¶è¿Ÿå…³è”</h4>

<blockquote>
<p>&lt;&lt;é«˜æ€§èƒ½MySQL&gt;&gt;

    <img src="/assets/images/mysql-deferred-join.png"  data-action="zoom" alt="mysql-deferred-join"  class="center"  />
</p>
</blockquote>

<h4 id="ä¸ªäººç†è§£">ä¸ªäººç†è§£</h4>

<ul>
<li>åŸæœ¬çš„è¯­å¥ç”±äºæŸ¥è¯¢æ¡ä»¶æ˜¯<code>SELECT * WHERE ... LIMIT</code>ï¼Œmysqlé¦–å…ˆé€šè¿‡whereè¿‡æ»¤å‡ºéœ€è¦è¿”å›çš„æ•°æ®ï¼Œå†æ ¹æ®limitæ‰«ææ•°æ®ï¼Œä¸¢å¼ƒæ•°æ®ï¼Œæœ€åè¿”å›æ­£ç¡®åç§»çš„æ•°æ®ã€‚</li>
<li>ä¼˜åŒ–åçš„è¯­å¥é¦–å…ˆé€šè¿‡è¦†ç›–ç´¢å¼•æ‹¿åˆ°å¯¹åº”çš„ä¸»é”®ï¼Œè™½ç„¶ä¹Ÿéœ€è¦æ‰«æç´¢å¼•æ•°æ®ï¼Œä½†æ˜¯æ‰«æç´¢å¼•çš„é€Ÿåº¦æ˜¯è¿œè¿œå¤§äºæ‰«ææ•°æ®çš„ï¼Œç„¶åå†é€šè¿‡ä¸»é”®å…³è”ä¸»è¡¨å¾—åˆ°éœ€è¦çš„æ•°æ®ï¼Œè¿™æ ·å……åˆ†åˆ©ç”¨äº†ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>

<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://www.cnblogs.com/Java3y/p/9969760.html" target="_blank">https://www.cnblogs.com/Java3y/p/9969760.html</a></li>
<li><a href="https://blog.csdn.net/u012817635/article/details/52277490" target="_blank">https://blog.csdn.net/u012817635/article/details/52277490</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Golang æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨å‘½ä»¤</title>
            <link>/posts/2018/09/29/go-exec/</link>
            <pubDate>Sat, 29 Sep 2018 00:00:00 +0000</pubDate>
            
            <guid>/posts/2018/09/29/go-exec/</guid>
            <description>æœ€è¿‘åœ¨åšphpæœåŠ¡è¿ç§»ï¼Œé‡åˆ°äº†éœ€è¦è°ƒç”¨ç³»ç»Ÿå¤–éƒ¨å‘½ä»¤(ffmpeg)ï¼Œå¤„ç†è§†é¢‘é¢„è§ˆå›¾çš„æƒ…å†µï¼Œä»¥å‰phpæ˜¯ç›´æ¥æ‰¾äº†è½®å­(php-ffmpeg)è§£å†³çš„ï¼Œä½†æœ¬è´¨å…¶å®ä¹Ÿå°±æ˜¯è°ƒç”¨äº†ç›¸å…³å‡½æ•°æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨çš„å‘½ä»¤ã€‚golangä¹Ÿæœ‰os/execè¿™ä¸ªåŒ…æ”¯æŒï¼Œæ ‡æ³¨ä¸€ä¸‹å¤‡å¿˜ã€‚
1ã€å…¶å®ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•
func Command(name string, arg ...string) *Cmd func (c *Cmd) Output() ([]byte, error) func (c *Cmd) CombinedOutput() ([]byte, error) é€šè¿‡è°ƒç”¨exec.Command()æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨å‘½ä»¤ï¼Œé€šè¿‡*Cmd.Output()æˆ–è€…*Cmd.CombinedOutput()è·å–æ‰§è¡Œç»“æœè¾“å‡ºã€‚ éœ€è¦æ³¨æ„çš„æ˜¯exec.Command()è¿™ä¸ªæ–¹æ³•çš„ä¼ å‚ã€‚
ä¾‹å¦‚ä¸‹é¢çš„å‘½åï¼šffmpeg -i input.flv -ss 00:00:14.435 -vframes 1 out.png
å¯¹åº”çš„è°ƒç”¨æ–¹å¼æ˜¯ï¼šexec.Command(&amp;quot;ffmpeg&amp;quot;, &amp;quot;-i&amp;quot;, &amp;quot;input.flv&amp;quot;, &amp;quot;-ss&amp;quot;, &amp;quot;00:00:00&amp;quot;, &amp;quot;-vframes&amp;quot;, &amp;quot;1&amp;quot;, &amp;quot;out.png&amp;quot;)
2ã€é’ˆå¯¹1ä¸­æåˆ°çš„æƒ…å†µï¼Œå†™äº†ä¸ªä¾‹å­ã€‚
package main import ( &amp;#34;fmt&amp;#34; &amp;#34;os/exec&amp;#34; &amp;#34;strings&amp;#34; ) func main() { cmd := &amp;#34;/usr/local/bin/ffmpeg&amp;#34; args := &amp;#34;-i %s -ss 00:00:00 -vframes 1 %s&amp;#34; output, err := exec.Command(cmd, strings.Split(fmt.Sprintf(args, &amp;#34;input.flv&amp;#34;, &amp;#34;out.png&amp;#34;), &amp;#34; &amp;#34;).</description>
            <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšphpæœåŠ¡è¿ç§»ï¼Œé‡åˆ°äº†éœ€è¦è°ƒç”¨ç³»ç»Ÿå¤–éƒ¨å‘½ä»¤(ffmpeg)ï¼Œå¤„ç†è§†é¢‘é¢„è§ˆå›¾çš„æƒ…å†µï¼Œä»¥å‰phpæ˜¯ç›´æ¥æ‰¾äº†è½®å­(php-ffmpeg)è§£å†³çš„ï¼Œä½†æœ¬è´¨å…¶å®ä¹Ÿå°±æ˜¯è°ƒç”¨äº†ç›¸å…³å‡½æ•°æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨çš„å‘½ä»¤ã€‚golangä¹Ÿæœ‰os/execè¿™ä¸ªåŒ…æ”¯æŒï¼Œæ ‡æ³¨ä¸€ä¸‹å¤‡å¿˜ã€‚</p>

<p>1ã€å…¶å®ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Command</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">arg</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Cmd</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cmd</span>) <span style="color:#a6e22e">Output</span>() ([]<span style="color:#66d9ef">byte</span>, <span style="color:#66d9ef">error</span>)
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cmd</span>) <span style="color:#a6e22e">CombinedOutput</span>() ([]<span style="color:#66d9ef">byte</span>, <span style="color:#66d9ef">error</span>)</code></pre></div>
<p>é€šè¿‡è°ƒç”¨<code>exec.Command()</code>æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨å‘½ä»¤ï¼Œé€šè¿‡<code>*Cmd.Output()</code>æˆ–è€…<code>*Cmd.CombinedOutput()</code>è·å–æ‰§è¡Œç»“æœè¾“å‡ºã€‚
éœ€è¦æ³¨æ„çš„æ˜¯<code>exec.Command()</code>è¿™ä¸ªæ–¹æ³•çš„ä¼ å‚ã€‚</p>

<p>ä¾‹å¦‚ä¸‹é¢çš„å‘½åï¼š<code>ffmpeg -i input.flv -ss 00:00:14.435 -vframes 1 out.png</code></p>

<p>å¯¹åº”çš„è°ƒç”¨æ–¹å¼æ˜¯ï¼š<code>exec.Command(&quot;ffmpeg&quot;, &quot;-i&quot;, &quot;input.flv&quot;, &quot;-ss&quot;, &quot;00:00:00&quot;, &quot;-vframes&quot;, &quot;1&quot;, &quot;out.png&quot;)</code></p>

<p>2ã€é’ˆå¯¹1ä¸­æåˆ°çš„æƒ…å†µï¼Œå†™äº†ä¸ªä¾‹å­ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
    <span style="color:#e6db74">&#34;fmt&#34;</span>
    <span style="color:#e6db74">&#34;os/exec&#34;</span>
    <span style="color:#e6db74">&#34;strings&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">cmd</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;/usr/local/bin/ffmpeg&#34;</span>
    <span style="color:#a6e22e">args</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;-i %s -ss 00:00:00 -vframes 1 %s&#34;</span>
    <span style="color:#a6e22e">output</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">exec</span>.<span style="color:#a6e22e">Command</span>(<span style="color:#a6e22e">cmd</span>, <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Split</span>(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#a6e22e">args</span>, <span style="color:#e6db74">&#34;input.flv&#34;</span>, <span style="color:#e6db74">&#34;out.png&#34;</span>), <span style="color:#e6db74">&#34; &#34;</span>)<span style="color:#f92672">...</span>).<span style="color:#a6e22e">CombinedOutput</span>()
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;err: %v\nout: %v\n&#34;</span>, <span style="color:#a6e22e">err</span>, string(<span style="color:#a6e22e">output</span>))
}</code></pre></div>
<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://golang.org/pkg/os/exec" target="_blank">https://golang.org/pkg/os/exec</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Golang mgo ä½¿ç”¨å¿ƒå¾—</title>
            <link>/posts/2018/06/29/go-mgo/</link>
            <pubDate>Fri, 29 Jun 2018 00:00:00 +0000</pubDate>
            
            <guid>/posts/2018/06/29/go-mgo/</guid>
            <description>æœ€è¿‘åœ¨ä½¿ç”¨mgoçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ€»ç»“æ ‡è®°ä¸€ä¸‹ã€‚
1ã€å…³äºmgoçš„è¿æ¥æ± é—®é¢˜ã€‚ç›¸å…³çš„å‡ ä¸ªæ–¹æ³•å¦‚ä¸‹
Dial(url string) (*Session, error) func (*Session) Clone() *Session func (*Session) Copy() *Session ç”¨ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•å¾—åˆ°çš„Sessionï¼Œä½¿ç”¨å®Œåéœ€è¦Close()ï¼Œå¦‚æœä¸closeçš„è¯ï¼Œè¿æ¥æ± ä¸­çš„sessionä¼šä¸€ç›´å¢åŠ ï¼Œç›´åˆ°é»˜è®¤é…ç½®çš„4096ã€‚ä¹‹åè·å–sessionçš„åç¨‹ä¼šsleepç­‰å¾…ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„sessionã€‚ä¸šåŠ¡ç«¯çš„è¡¨ç°å°±æ˜¯ç¨‹åºæŒ‚æ­»ï¼Œç±»ä¼¼æ­»é”çš„è¡¨ç°ğŸ˜‚ã€‚æ‰€ä»¥sessionç”¨å®Œåä¸€å®šè¦defer closeæ‰ã€‚
2ã€é’ˆå¯¹1ä¸­æåˆ°çš„æƒ…å†µï¼Œå†™äº†ä¸ªæ–¹æ³•è°ƒç”¨mgo Collectionä¸‹å¯¹åº”çš„å‡½æ•°ã€‚
package main import ( &amp;#34;fmt&amp;#34; &amp;#34;gopkg.in/mgo.v2&amp;#34; ) var ( session *mgo.Session ) func Session() *mgo.Session { if session == nil { var err error session, err = mgo.Dial(&amp;#34;root:root@127.0.0.1:27017&amp;#34;) if err != nil { panic(err) } } return session.Clone() } func Magic(database string, collection string, f func(*mgo.Collection) error) error { session := Session() defer func() { if session !</description>
            <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ä½¿ç”¨mgoçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ€»ç»“æ ‡è®°ä¸€ä¸‹ã€‚</p>

<p>1ã€å…³äºmgoçš„è¿æ¥æ± é—®é¢˜ã€‚ç›¸å…³çš„å‡ ä¸ªæ–¹æ³•å¦‚ä¸‹</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">Dial</span>(<span style="color:#a6e22e">url</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Session</span>, <span style="color:#66d9ef">error</span>)
<span style="color:#66d9ef">func</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">Session</span>) <span style="color:#a6e22e">Clone</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Session</span>
<span style="color:#66d9ef">func</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">Session</span>) <span style="color:#a6e22e">Copy</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Session</span></code></pre></div>
<p>ç”¨ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•å¾—åˆ°çš„Sessionï¼Œä½¿ç”¨å®Œåéœ€è¦Close()ï¼Œå¦‚æœä¸closeçš„è¯ï¼Œè¿æ¥æ± ä¸­çš„sessionä¼šä¸€ç›´å¢åŠ ï¼Œç›´åˆ°é»˜è®¤é…ç½®çš„4096ã€‚ä¹‹åè·å–sessionçš„åç¨‹ä¼šsleepç­‰å¾…ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„sessionã€‚ä¸šåŠ¡ç«¯çš„è¡¨ç°å°±æ˜¯ç¨‹åºæŒ‚æ­»ï¼Œç±»ä¼¼æ­»é”çš„è¡¨ç°ğŸ˜‚ã€‚<strong>æ‰€ä»¥sessionç”¨å®Œåä¸€å®šè¦defer closeæ‰</strong>ã€‚</p>

<p>2ã€é’ˆå¯¹1ä¸­æåˆ°çš„æƒ…å†µï¼Œå†™äº†ä¸ªæ–¹æ³•è°ƒç”¨mgo Collectionä¸‹å¯¹åº”çš„å‡½æ•°ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
    <span style="color:#e6db74">&#34;fmt&#34;</span>
    <span style="color:#e6db74">&#34;gopkg.in/mgo.v2&#34;</span>
)

<span style="color:#66d9ef">var</span> (
    <span style="color:#a6e22e">session</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">mgo</span>.<span style="color:#a6e22e">Session</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Session</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">mgo</span>.<span style="color:#a6e22e">Session</span> {
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">session</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
        <span style="color:#a6e22e">session</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">mgo</span>.<span style="color:#a6e22e">Dial</span>(<span style="color:#e6db74">&#34;root:root@127.0.0.1:27017&#34;</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
            panic(<span style="color:#a6e22e">err</span>)
        }
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Clone</span>()
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Magic</span>(<span style="color:#a6e22e">database</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">collection</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">mgo</span>.<span style="color:#a6e22e">Collection</span>) <span style="color:#66d9ef">error</span>) <span style="color:#66d9ef">error</span> {
    <span style="color:#a6e22e">session</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Session</span>()
    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">session</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">Close</span>()
        }
    }()

    <span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">DB</span>(<span style="color:#a6e22e">database</span>).<span style="color:#a6e22e">C</span>(<span style="color:#a6e22e">collection</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">c</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">m</span> <span style="color:#66d9ef">interface</span>{}
    <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Magic</span>(<span style="color:#e6db74">&#34;test&#34;</span>, <span style="color:#e6db74">&#34;test&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">mgo</span>.<span style="color:#a6e22e">Collection</span>) <span style="color:#66d9ef">error</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#66d9ef">nil</span>).<span style="color:#a6e22e">One</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">m</span>)
    })
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">m</span>)
}</code></pre></div>
<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://godoc.org/gopkg.in/mgo.v2" target="_blank">https://godoc.org/gopkg.in/mgo.v2</a></li>
<li><a href="http://www.cnblogs.com/shenguanpu/p/5318727.html" target="_blank">http://www.cnblogs.com/shenguanpu/p/5318727.html</a></li>
<li><a href="https://golangtc.com/t/53073b69320b526197000067" target="_blank">https://golangtc.com/t/53073b69320b526197000067</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>PHP7.2 AESåŠ è§£å¯†</title>
            <link>/posts/2018/01/18/php72-aes/</link>
            <pubDate>Thu, 18 Jan 2018 00:00:00 +0000</pubDate>
            
            <guid>/posts/2018/01/18/php72-aes/</guid>
            <description> ç”±äºMcryptåº“ä»PHP 7.1.0 å¼€å§‹åºŸå¼ƒï¼›è‡ª PHP 7.2.0 èµ·ï¼Œä¼šç§»åˆ° PECLã€‚
 æ‰€ä»¥ä¹‹å‰ä½¿ç”¨PHP AESåŠ è§£å¯†çš„ç›¸å…³å‡½æ•°ï¼ˆmcrypt_encryptã€mcrypt_decrypt&amp;hellip;ï¼‰åœ¨PHP7.1+ä¸­éƒ½å·²ç»åºŸé™¤äº†ï¼Œæ–°ç‰ˆPHPä¸­é€šè¿‡OpenSSLåº“çš„ç›¸å…³æ–¹æ³•æ¥å®ç°AESç­‰åŠ è§£å¯†ã€‚
 openssl_encrypt openssl_decrypt
 å…¶å®æ‰‹å†Œä¸Šçš„è¯´æ˜å·²ç»éå¸¸æ¸…æ¥šäº†ï¼Œä½†æ˜¯å‡½æ•°å£°æ˜ä¸­çš„optionså‚æ•°çš„è¯´æ˜è®©æˆ‘å¾ˆå›°æƒ‘ï¼Œç»è¿‡å®è·µåæ•´ç†ç»“è®ºå¦‚ä¸‹
    options value è¯´æ˜     NULL 0 è¿”å›base64ç¼–ç åçš„å­—ç¬¦ä¸²   OPENSSL_RAW_DATA 1 è¿”å›åŸå§‹å­—ç¬¦ä¸²   OPENSSL_ZERO_PADDING 2 ä¸å¡«å……å­—ç¬¦ä¸²ï¼ˆé»˜è®¤ä½¿ç”¨PKCS#7å¡«å……å­—ç¬¦ä¸²ï¼‰     æ‰€ä»¥ä¹‹å‰ç”¨mcrypt_encryptæ–¹æ³•åŠ å¯†å¾—åˆ°çš„å¯†æ–‡ï¼Œåœ¨æ–°ç‰ˆä¸­åªè¦ç”¨openssl_decryptæ–¹æ³•å¹¶ä¸”ä½¿ç”¨options=0æ¥è§£å¯†å³å¯ã€‚
å‚è€ƒ
 https://secure.php.net/manual/zh/function.openssl-encrypt.php#117208 https://secure.php.net/manual/zh/function.openssl-decrypt.php#119577  </description>
            <content type="html"><![CDATA[<blockquote>
<p><a href="https://secure.php.net/manual/zh/intro.mcrypt.php" target="_blank">ç”±äºMcryptåº“ä»PHP 7.1.0 å¼€å§‹åºŸå¼ƒï¼›è‡ª PHP 7.2.0 èµ·ï¼Œä¼šç§»åˆ° PECLã€‚</a></p>
</blockquote>

<p>æ‰€ä»¥ä¹‹å‰ä½¿ç”¨PHP AESåŠ è§£å¯†çš„ç›¸å…³å‡½æ•°ï¼ˆ<code>mcrypt_encrypt</code>ã€<code>mcrypt_decrypt</code>&hellip;ï¼‰åœ¨PHP7.1+ä¸­éƒ½å·²ç»åºŸé™¤äº†ï¼Œæ–°ç‰ˆPHPä¸­é€šè¿‡OpenSSLåº“çš„ç›¸å…³æ–¹æ³•æ¥å®ç°AESç­‰åŠ è§£å¯†ã€‚</p>

<blockquote>
<p><a href="https://secure.php.net/manual/zh/function.openssl-encrypt.php" target="_blank">openssl_encrypt</a> <br />
  <a href="https://secure.php.net/manual/zh/function.openssl-decrypt.php" target="_blank">openssl_decrypt</a></p>
</blockquote>

<p>å…¶å®æ‰‹å†Œä¸Šçš„è¯´æ˜å·²ç»éå¸¸æ¸…æ¥šäº†ï¼Œä½†æ˜¯å‡½æ•°å£°æ˜ä¸­çš„optionså‚æ•°çš„è¯´æ˜è®©æˆ‘å¾ˆå›°æƒ‘ï¼Œç»è¿‡å®è·µåæ•´ç†ç»“è®ºå¦‚ä¸‹</p>

<blockquote>
<table>
<thead>
<tr>
<th align="center">options</th>
<th align="center">value</th>
<th align="center">è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center"><code>NULL</code></td>
<td align="center">0</td>
<td align="center">è¿”å›<code>base64</code>ç¼–ç åçš„å­—ç¬¦ä¸²</td>
</tr>

<tr>
<td align="center"><code>OPENSSL_RAW_DATA</code></td>
<td align="center">1</td>
<td align="center">è¿”å›åŸå§‹å­—ç¬¦ä¸²</td>
</tr>

<tr>
<td align="center"><code>OPENSSL_ZERO_PADDING</code></td>
<td align="center">2</td>
<td align="center">ä¸å¡«å……å­—ç¬¦ä¸²ï¼ˆé»˜è®¤ä½¿ç”¨<code>PKCS#7</code>å¡«å……å­—ç¬¦ä¸²ï¼‰</td>
</tr>
</tbody>
</table>
</blockquote>

<p>æ‰€ä»¥ä¹‹å‰ç”¨<code>mcrypt_encrypt</code>æ–¹æ³•åŠ å¯†å¾—åˆ°çš„å¯†æ–‡ï¼Œåœ¨æ–°ç‰ˆä¸­åªè¦ç”¨<code>openssl_decrypt</code>æ–¹æ³•å¹¶ä¸”ä½¿ç”¨<code>options=0</code>æ¥è§£å¯†å³å¯ã€‚</p>

<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://secure.php.net/manual/zh/function.openssl-encrypt.php#117208" target="_blank">https://secure.php.net/manual/zh/function.openssl-encrypt.php#117208</a></li>
<li><a href="https://secure.php.net/manual/zh/function.openssl-decrypt.php#119577" target="_blank">https://secure.php.net/manual/zh/function.openssl-decrypt.php#119577</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Golangä¸­çš„JSONå¤„ç†æŠ€å·§</title>
            <link>/posts/2017/07/18/go-struct-nil-pointer/</link>
            <pubDate>Tue, 18 Jul 2017 00:00:00 +0000</pubDate>
            
            <guid>/posts/2017/07/18/go-struct-nil-pointer/</guid>
            <description>åˆå¥½ä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œæœ€è¿‘å› ä¸ºé¡¹ç›®éœ€è¦å­¦ä¹ äº†ä¸‹Goè¯­è¨€ï¼Œæ‰çœŸæ­£æ˜ç™½äº†ä¸ºä»€ä¹ˆè¯´PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ğŸ¤£ã€‚è¨€å½’æ­£ä¼ ï¼Œé¦–å…ˆå…ˆæ¨èæœ¬ç§˜ç± build-web-application-with-golang Githubä¸Šçš„é«˜æ˜Ÿé¡¹ç›®ï¼Œä½œè€…åŒæ—¶ä¹Ÿæ˜¯beegoæ¡†æ¶çš„å¼€å‘è€…ï¼Œæœ¬é¡¹ç›®æ˜¯ä½œè€…ä½¿ç”¨Goè¿›è¡ŒWebå¼€å‘çš„ç»éªŒæ€»ç»“ï¼Œæ»¡æ»¡çš„å¹²è´§ã€‚
æ‰€ä»¥åŸºç¡€çš„JSONå¤„ç†å°±ç›´æ¥å‚è€ƒæ–‡æ¡£å§ï¼Œä¸»è¦å†…å®¹å¤§æ¦‚æ˜¯Goä¸­æœ‰ä¸“é—¨çš„JSONåŒ…æ¥å¤„ç†JSONæ•°æ®ï¼Œé€šè¿‡å®šä¹‰å¯¹åº”çš„structï¼Œtagæ˜ å°„å­—æ®µï¼Œå¾ˆæ–¹ä¾¿çš„å¯ä»¥æŠŠJSONæ•°æ®è½¬æˆstructï¼Œæˆ–è€…æŠŠstructè½¬åŒ–æˆJSONå­—ç¬¦ä¸²ã€‚
å…¶ä¸­æ–‡æ¡£ä¸­æœ‰æ®µæè¿°æ˜¯è¿™æ ·çš„ï¼š
 tagä¸­å¦‚æœå¸¦æœ‰&amp;rdquo;omitempty&amp;rdquo;é€‰é¡¹ï¼Œé‚£ä¹ˆå¦‚æœè¯¥å­—æ®µå€¼ä¸ºç©ºï¼Œå°±ä¸ä¼šè¾“å‡ºåˆ°JSONä¸²ä¸­ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ï¼Œå½“æŸä¸ªå­—æ®µä¸ºç©ºæ—¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¯¥å­—æ®µä¹Ÿè¾“å‡ºåœ¨JSONå­—ç¬¦ä¸²ä¸­ï¼Œé€šè¿‡åœ¨ç»“æ„ä½“çš„tagä¸­å®šä¹‰omitemptyå°±å¯ä»¥è¾¾åˆ°è¯¥ç›®çš„ã€‚
 type DataAttachment struct { Id string `json:&amp;#34;id,omitempty&amp;#34;` Head DataAttachmentHead `json:&amp;#34;head,omitempty&amp;#34;` Body DataAttachmentBody `json:&amp;#34;body,omitempty&amp;#34;` } type DataAttachmentHead struct { Text string `json:&amp;#34;text,omitempty&amp;#34;` Bgcolor string `json:&amp;#34;bgcolor,omitempty&amp;#34;` Tcolor string `json:&amp;#34;tcolor,omitempty&amp;#34;` } type DataAttachmentBody struct { Title string `json:&amp;#34;title,omitempty&amp;#34;` Image string `json:&amp;#34;image,omitempty&amp;#34;` Content string `json:&amp;#34;content,omitempty&amp;#34;` } ä»¥ä¸ŠDataAttachmentè¿™ä¸ªç»“æ„ï¼Œé€šè¿‡å¯¹headï¼Œbodyå®šä¹‰omitemptyé€‰é¡¹ï¼Œæˆ‘ä»¬é¢„æœŸæ˜¯å¸Œæœ›å¦‚æœå½“headï¼Œbodyä¸ºç©ºæ—¶ï¼Œå¯ä»¥ä¸è¾“å‡ºè¿™2ä¸ªå­—æ®µåˆ°JSONä¸­ã€‚ä½†æ˜¯äº‹å®ä¸Šå´å’Œæˆ‘ä»¬é¢„æœŸçš„æœ‰æ‰€å·®å¼‚ï¼Œæˆ‘ä»¬é€šè¿‡json.Marshalå¾—åˆ°çš„JSONä¸­è¿˜æ˜¯ä¼šæœ‰ç©ºçš„headå’Œbodyã€‚
æ‰€ä»¥æˆ‘ä»¬è¦æ€æ ·æ‰èƒ½å®ç°æˆ‘ä»¬çš„ç›®çš„å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œä¼ æŒ‡é’ˆ
type DataAttachment struct { Id string `json:&amp;#34;id,omitempty&amp;#34;` Head *DataAttachmentHead `json:&amp;#34;head,omitempty&amp;#34;` Body *DataAttachmentBody `json:&amp;#34;body,omitempty&amp;#34;` } å‚è€ƒ
 https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/07.2.md build-web-application-with-golang https://stackoverflow.</description>
            <content type="html"><![CDATA[<p>åˆå¥½ä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œæœ€è¿‘å› ä¸ºé¡¹ç›®éœ€è¦å­¦ä¹ äº†ä¸‹Goè¯­è¨€ï¼Œæ‰çœŸæ­£æ˜ç™½äº†ä¸ºä»€ä¹ˆè¯´PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ğŸ¤£ã€‚è¨€å½’æ­£ä¼ ï¼Œé¦–å…ˆå…ˆæ¨èæœ¬ç§˜ç±
<a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/preface.md" target="_blank">build-web-application-with-golang</a> Githubä¸Šçš„é«˜æ˜Ÿé¡¹ç›®ï¼Œä½œè€…åŒæ—¶ä¹Ÿæ˜¯beegoæ¡†æ¶çš„å¼€å‘è€…ï¼Œæœ¬é¡¹ç›®æ˜¯ä½œè€…ä½¿ç”¨Goè¿›è¡ŒWebå¼€å‘çš„ç»éªŒæ€»ç»“ï¼Œæ»¡æ»¡çš„å¹²è´§ã€‚</p>

<p>æ‰€ä»¥åŸºç¡€çš„<a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/07.2.md" target="_blank">JSONå¤„ç†</a>å°±ç›´æ¥å‚è€ƒæ–‡æ¡£å§ï¼Œä¸»è¦å†…å®¹å¤§æ¦‚æ˜¯Goä¸­æœ‰ä¸“é—¨çš„JSONåŒ…æ¥å¤„ç†JSONæ•°æ®ï¼Œé€šè¿‡å®šä¹‰å¯¹åº”çš„structï¼Œtagæ˜ å°„å­—æ®µï¼Œå¾ˆæ–¹ä¾¿çš„å¯ä»¥æŠŠJSONæ•°æ®è½¬æˆstructï¼Œæˆ–è€…æŠŠstructè½¬åŒ–æˆJSONå­—ç¬¦ä¸²ã€‚</p>

<p>å…¶ä¸­æ–‡æ¡£ä¸­æœ‰æ®µæè¿°æ˜¯è¿™æ ·çš„ï¼š</p>

<blockquote>
<p>tagä¸­å¦‚æœå¸¦æœ‰&rdquo;omitempty&rdquo;é€‰é¡¹ï¼Œé‚£ä¹ˆå¦‚æœè¯¥å­—æ®µå€¼ä¸ºç©ºï¼Œå°±ä¸ä¼šè¾“å‡ºåˆ°JSONä¸²ä¸­ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ï¼Œå½“æŸä¸ªå­—æ®µä¸ºç©ºæ—¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¯¥å­—æ®µä¹Ÿè¾“å‡ºåœ¨JSONå­—ç¬¦ä¸²ä¸­ï¼Œé€šè¿‡åœ¨ç»“æ„ä½“çš„tagä¸­å®šä¹‰<code>omitempty</code>å°±å¯ä»¥è¾¾åˆ°è¯¥ç›®çš„ã€‚</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DataAttachment</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Id</span>     <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`json:&#34;id,omitempty&#34;`</span>
    <span style="color:#a6e22e">Head</span>   <span style="color:#a6e22e">DataAttachmentHead</span>     <span style="color:#e6db74">`json:&#34;head,omitempty&#34;`</span>
    <span style="color:#a6e22e">Body</span>   <span style="color:#a6e22e">DataAttachmentBody</span>     <span style="color:#e6db74">`json:&#34;body,omitempty&#34;`</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DataAttachmentHead</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Text</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;text,omitempty&#34;`</span>
    <span style="color:#a6e22e">Bgcolor</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;bgcolor,omitempty&#34;`</span>
    <span style="color:#a6e22e">Tcolor</span>  <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;tcolor,omitempty&#34;`</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DataAttachmentBody</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Title</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;title,omitempty&#34;`</span>
    <span style="color:#a6e22e">Image</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;image,omitempty&#34;`</span>
    <span style="color:#a6e22e">Content</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;content,omitempty&#34;`</span>
}</code></pre></div>
<p>ä»¥ä¸ŠDataAttachmentè¿™ä¸ªç»“æ„ï¼Œé€šè¿‡å¯¹headï¼Œbodyå®šä¹‰omitemptyé€‰é¡¹ï¼Œæˆ‘ä»¬é¢„æœŸæ˜¯å¸Œæœ›å¦‚æœå½“headï¼Œbodyä¸ºç©ºæ—¶ï¼Œå¯ä»¥ä¸è¾“å‡ºè¿™2ä¸ªå­—æ®µåˆ°JSONä¸­ã€‚ä½†æ˜¯äº‹å®ä¸Šå´å’Œæˆ‘ä»¬é¢„æœŸçš„æœ‰æ‰€å·®å¼‚ï¼Œæˆ‘ä»¬é€šè¿‡<code>json.Marshal</code>å¾—åˆ°çš„JSONä¸­è¿˜æ˜¯ä¼šæœ‰ç©ºçš„headå’Œbodyã€‚</p>

<p>æ‰€ä»¥æˆ‘ä»¬è¦æ€æ ·æ‰èƒ½å®ç°æˆ‘ä»¬çš„ç›®çš„å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œ<strong>ä¼ æŒ‡é’ˆ</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DataAttachment</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Id</span>     <span style="color:#66d9ef">string</span>                 <span style="color:#e6db74">`json:&#34;id,omitempty&#34;`</span>
    <span style="color:#a6e22e">Head</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">DataAttachmentHead</span>     <span style="color:#e6db74">`json:&#34;head,omitempty&#34;`</span>
    <span style="color:#a6e22e">Body</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">DataAttachmentBody</span>     <span style="color:#e6db74">`json:&#34;body,omitempty&#34;`</span>
}</code></pre></div>
<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/07.2.md" target="_blank">https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/07.2.md</a></li>
<li><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/preface.md" target="_blank">build-web-application-with-golang</a></li>
<li><a href="https://stackoverflow.com/questions/18088294/how-to-not-marshal-an-empty-struct-into-json-with-go" target="_blank">https://stackoverflow.com/questions/18088294/how-to-not-marshal-an-empty-struct-into-json-with-go</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Lumenä¸­ä½¿ç”¨ValidatorMiddlewareä¸­é—´ä»¶å¤„ç†è¯·æ±‚å‚æ•°éªŒè¯</title>
            <link>/posts/2017/03/08/validator-middleware/</link>
            <pubDate>Wed, 08 Mar 2017 00:00:00 +0000</pubDate>
            
            <guid>/posts/2017/03/08/validator-middleware/</guid>
            <description>æœ¬æ¬¡æ–‡ç« çš„ç¼˜ç”±æ¥ä¹‹ä¸‹é¢è¿™æ®µä»£ç 
public function test() { $message = [ &amp;#39;object_id.required&amp;#39; =&amp;gt; ErrorCode::PARAM_MISS, ]; $validator = Validator::make($this-&amp;gt;request-&amp;gt;all(), [ &amp;#39;object_id&amp;#39; =&amp;gt; &amp;#39;required&amp;#39;, ], $message); if ($validator-&amp;gt;fails()) { ...error } ... } ä¸Šé¢è¿™ä¸ªåœºæ™¯åº”è¯¥åº”è¯¥å¤§å®¶éƒ½ä¸ä¼šé™Œç”Ÿï¼ŒéªŒè¯è¯·æ±‚å‚æ•°æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„åœºæ™¯ï¼Œå½“éœ€è¦éªŒè¯çš„å‚æ•°è¾ƒå°‘æ—¶çœ‹ä¸Šå»ä¹Ÿè¿˜èƒ½å‹‰å¼ºæ¥å—ï¼Œä½†å¦‚æœæ¥å£æ¥æ”¶çš„å‚æ•°è¾ƒå¤šæ—¶å°±ä¼šå˜æˆè¿™æ ·ğŸ˜‚
 ï¼ˆå…¶å®è¿˜æœ‰10+ä¸ªå‚æ•°çš„å›¾ï¼Œè€ƒè™‘åˆ°å¯†é›†ææƒ§ç—‡æ‚£è€…çš„æ„Ÿå—æ²¡æœ‰å‘ğŸ™‚ï¼‰å¥½å§ï¼Œæ²¡åŠæ³•ã€‚è°è®©æˆ‘ä»¬è¿™ä¸ªæ¥å£æ¥æ”¶çš„å‚æ•°å¤šå‘¢ï¼æ€ä¹ˆåŠï¼Œæˆ‘ä¹Ÿå¾ˆæ— å¥ˆå‘€ï¼
æ€è€ƒï¼šçœŸçš„æ²¡æœ‰åŠæ³•å—ï¼Ÿæˆ‘reviewäº†æœ€è¿‘å†™çš„å‡ ä¸ªcontrollerï¼Œå‘ç°äº†ä¸€ä¸ªå…±åŒç‚¹ï¼šæ¯ä¸€ä¸ªæ¥å£è¯·æ±‚å¯¹åº”çš„å¤„ç†çš„æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€æ®µéƒ½æ˜¯å¤„ç†å¯¹åº”çš„å‚æ•°éªŒè¯çš„é€»è¾‘ï¼Œè¿™æ®µé€»è¾‘é™¤äº†å¯¹åº”æ¥å£çš„éªŒè¯è§„åˆ™ä¸ä¸€æ ·ï¼Œå…¶ä»–éƒ½æ˜¯è°ƒç”¨ç›¸åŒçš„é€»è¾‘ã€‚å…¶å®éƒ½æ˜¯é‡å¤çš„ä»£ç ï¼æ€ä¹ˆæ ·å¯ä»¥æŠŠè¿™äº›ä»£ç ä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿ
å¥½ï¼Œé€šè¿‡åˆ†æä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”æ˜¯å¼•ç”¨ä¸­é—´ä»¶æ¥ç»Ÿä¸€å¤„ç†è¿™éƒ¨åˆ†çš„é€»è¾‘ã€‚ç½‘ä¸Šæ‰¾äº†ä¸‹ç›¸å…³çš„å¤„ç†æ–¹å¼ï¼Œå¹¶ä¸”å‚è€ƒäº†ä¸‹Laravel FormRequestçš„å®ç°ï¼Œæˆ‘è®¾è®¡äº†ValidatorMiddlewareä¸­é—´ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ã€‚
namespace App\Http\Middleware; use Closure; class ValidatorMiddleware { /** * Handle an incoming request. * * @param \Illuminate\Http\Request $request * @param \Closure $next * @return mixed */ public function handle($request, Closure $next) { list($controller, $method) = explode(&amp;#39;@&amp;#39;, $request-&amp;gt;route()[1][&amp;#39;uses&amp;#39;]); $class = str_replace(&amp;#39;Controller&amp;#39;, &amp;#39;Request&amp;#39;, $controller); if (class_exists($class)) { $messageRequest = new $class($request, $method); $messageRequest-&amp;gt;validate(); } return $next($request); } }/** Requestå¤„ç†åŸºç±» **/ namespace App\Http\Requests; use Illuminate\Http\Request; use App\Exceptions\ResponseException; use Validator; class BaseRequest { protected $input; protected $method; public function __construct(Request $request, String $method) { $this-&amp;gt;input = $request-&amp;gt;all(); $this-&amp;gt;method = $method; } public function rules() { return []; } public function messages() { return []; } public function validate() { $rules = array_get($this-&amp;gt;rules(), $this-&amp;gt;method, []); $messages = array_get($this-&amp;gt;messages(), $this-&amp;gt;method, []); $validator = Validator::make($this-&amp;gt;input, $rules, $messages); if ($validator-&amp;gt;fails()) { $err = $validator-&amp;gt;errors()-&amp;gt;all(); throw new ResponseException(head($err)); } return true; } } ä¸‹é¢ç»“åˆå®é™…çš„ä¾‹å­æ¥è®²è§£:</description>
            <content type="html"><![CDATA[<p>æœ¬æ¬¡æ–‡ç« çš„ç¼˜ç”±æ¥ä¹‹ä¸‹é¢è¿™æ®µä»£ç </p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">public function test()
{
    $message = [
        &#39;object_id.required&#39; =&gt; ErrorCode::PARAM_MISS,
    ];
    $validator = Validator::make($this-&gt;request-&gt;all(), [
        &#39;object_id&#39; =&gt; &#39;required&#39;,
    ], $message);
    if ($validator-&gt;fails()) {
        ...error
    }
    ...
}</code></pre></div>
<p>ä¸Šé¢è¿™ä¸ªåœºæ™¯åº”è¯¥åº”è¯¥å¤§å®¶éƒ½ä¸ä¼šé™Œç”Ÿï¼ŒéªŒè¯è¯·æ±‚å‚æ•°æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„åœºæ™¯ï¼Œå½“éœ€è¦éªŒè¯çš„å‚æ•°è¾ƒå°‘æ—¶çœ‹ä¸Šå»ä¹Ÿè¿˜èƒ½å‹‰å¼ºæ¥å—ï¼Œä½†å¦‚æœæ¥å£æ¥æ”¶çš„å‚æ•°è¾ƒå¤šæ—¶å°±ä¼šå˜æˆè¿™æ ·ğŸ˜‚</p>

<p>
    <img src="/assets/images/validator-middleware-1.png"  data-action="zoom" alt="validator-middleware-1"  class="center"  />

ï¼ˆå…¶å®è¿˜æœ‰10+ä¸ªå‚æ•°çš„å›¾ï¼Œè€ƒè™‘åˆ°å¯†é›†ææƒ§ç—‡æ‚£è€…çš„æ„Ÿå—æ²¡æœ‰å‘ğŸ™‚ï¼‰å¥½å§ï¼Œæ²¡åŠæ³•ã€‚è°è®©æˆ‘ä»¬è¿™ä¸ªæ¥å£æ¥æ”¶çš„å‚æ•°å¤šå‘¢ï¼æ€ä¹ˆåŠï¼Œæˆ‘ä¹Ÿå¾ˆæ— å¥ˆå‘€ï¼</p>

<p><strong>æ€è€ƒ</strong>ï¼šçœŸçš„æ²¡æœ‰åŠæ³•å—ï¼Ÿæˆ‘reviewäº†æœ€è¿‘å†™çš„å‡ ä¸ªcontrollerï¼Œå‘ç°äº†ä¸€ä¸ªå…±åŒç‚¹ï¼šæ¯ä¸€ä¸ªæ¥å£è¯·æ±‚å¯¹åº”çš„å¤„ç†çš„æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€æ®µéƒ½æ˜¯å¤„ç†å¯¹åº”çš„å‚æ•°éªŒè¯çš„é€»è¾‘ï¼Œè¿™æ®µé€»è¾‘é™¤äº†å¯¹åº”æ¥å£çš„éªŒè¯è§„åˆ™ä¸ä¸€æ ·ï¼Œå…¶ä»–éƒ½æ˜¯è°ƒç”¨ç›¸åŒçš„é€»è¾‘ã€‚å…¶å®éƒ½æ˜¯é‡å¤çš„ä»£ç ï¼æ€ä¹ˆæ ·å¯ä»¥æŠŠè¿™äº›ä»£ç ä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿ</p>

<p>å¥½ï¼Œé€šè¿‡åˆ†æä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”æ˜¯å¼•ç”¨ä¸­é—´ä»¶æ¥ç»Ÿä¸€å¤„ç†è¿™éƒ¨åˆ†çš„é€»è¾‘ã€‚ç½‘ä¸Šæ‰¾äº†ä¸‹ç›¸å…³çš„å¤„ç†æ–¹å¼ï¼Œå¹¶ä¸”å‚è€ƒäº†ä¸‹Laravel FormRequestçš„å®ç°ï¼Œæˆ‘è®¾è®¡äº†ValidatorMiddlewareä¸­é—´ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">namespace App\Http\Middleware;

use Closure;

class ValidatorMiddleware
{
    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    public function handle($request, Closure $next)
    {
        list($controller, $method) = explode(&#39;@&#39;, $request-&gt;route()[1][&#39;uses&#39;]);
        $class = str_replace(&#39;Controller&#39;, &#39;Request&#39;, $controller);
        if (class_exists($class)) {
            $messageRequest = new $class($request, $method);
            $messageRequest-&gt;validate();
        }

        return $next($request);
    }
}</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">/** Requestå¤„ç†åŸºç±» **/
namespace App\Http\Requests;

use Illuminate\Http\Request;
use App\Exceptions\ResponseException;
use Validator;

class BaseRequest
{
    protected $input;
    protected $method;

    public function __construct(Request $request, String $method)
    {
        $this-&gt;input = $request-&gt;all();
        $this-&gt;method = $method;
    }

    public function rules()
    {
        return [];
    }

    public function messages()
    {
        return [];
    }

    public function validate()
    {
        $rules = array_get($this-&gt;rules(), $this-&gt;method, []);
        $messages = array_get($this-&gt;messages(), $this-&gt;method, []);
        $validator = Validator::make($this-&gt;input, $rules, $messages);
        if ($validator-&gt;fails()) {
            $err = $validator-&gt;errors()-&gt;all();
            throw new ResponseException(head($err));
        }

        return true;
    }
}</code></pre></div>
<p>ä¸‹é¢ç»“åˆå®é™…çš„ä¾‹å­æ¥è®²è§£:</p>

<blockquote>
<p>è¯·æ±‚url: /user/get?id=1 <br />
å¯¹åº”å¤„ç†çš„controller@function: UserController@get <br /></p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">/** é‚£ä¹ˆå¯¹åº”çš„UserRequest */
namespace App\Http\Requests;

use App\ErrorCode;
use App\Http\Requests\BaseRequest;

class UserRequest extends BaseRequest
{
    public function rules()
    {
        return [
            &#39;get&#39; =&gt; [
                &#39;id&#39; =&gt; &#39;required|integer&#39;,
            ]
        ];
    }

    public function messages()
    {
        return [
            &#39;get&#39; =&gt; [
                &#39;id.required&#39; =&gt; ErrorCode::PARAM_MISS,
                &#39;id.integer&#39; =&gt; ErrorCode::PARAM_ERROR,
            ]
        ];
    }
}</code></pre></div>
<p>å½“/user/get?id=1è¢«è®¿é—®æ—¶ï¼Œé¦–å…ˆä¼šè¿›å…¥<code>ValidatorMiddleware-&gt;handle</code>æ–¹æ³•ä¸­ï¼Œ<code>$request-&gt;route()[1]['uses']</code>ä¼šè¿”å›<code>App\Http\Controllers\UserController@get</code>, æ‰€ä»¥ä»£ç å…ˆä¼šå»æ‰¾æœ‰æ²¡æœ‰å¯¹åº”çš„<code>App\Http\Requests\UserRequest</code>, å¦‚æœæœ‰åˆ™ä¼šå»æ‰§è¡Œå®ƒçš„validateæ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹UserRequestï¼Œå®ƒé‡Œé¢å¹¶æ²¡æœ‰validateï¼Œä½†æ˜¯å®ƒç»§æ‰¿äº†BaseRequestï¼Œæ‰€ä»¥æˆ‘ä»¬å†çœ‹BaseRequestçš„validateï¼Œè¿™é‡Œçš„ä»£ç å°±æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è°ƒç”¨Lumençš„Validatorç±»è¿›è¡Œå‚æ•°éªŒè¯çš„é€»è¾‘äº†ï¼Œç”±äºåœ¨new UserRequestæ—¶æŒ‡å®šäº†methodå‚æ•°ï¼Œæ‰€ä»¥åœ¨éªŒè¯æ—¶ä¼šå»å–æ–¹æ³•å¯¹åº”çš„éªŒè¯è§„åˆ™è¿›è¡Œå‚æ•°éªŒè¯ï¼Œå¦‚æœå¤±è´¥åˆ™ä¼šæŠ›å‡ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸ï¼Œæœ€åï¼Œæˆ‘ä»¬åªè¦åœ¨<code>Exception\Handler</code>ä¸­å¤„ç†è‡ªå®šä¹‰çš„å¼‚å¸¸å°±å¥½äº†ã€‚</p>

<p>å£æ°´äº†ä¸€å¤§å †ï¼Œä¸‹é¢æ€»ç»“ä¸€ä¸‹ï¼Œæ ¸å¿ƒæ€æƒ³å¦‚ä¸‹ï¼š</p>

<blockquote>
<p>Controllersç›®å½•åŒçº§ä¸‹ä¼šå¤šå‡ºä¸€ä¸ªRequestsç›®å½•ï¼Œæ¯ä¸ªcontrolleréƒ½ä¼šæœ‰å¯¹åº”çš„requestç±»ï¼Œrequestç±»ä¸­ä¼šæœ‰rulesã€messagesï¼ˆå¯¹åº”Validatorç±»çš„éªŒè¯è§„åˆ™å’Œè¿”å›æ¶ˆæ¯ï¼‰ä¿©ä¸ªäºŒç»´æ•°ç»„ï¼Œä¸€ç»´çš„é”®å€¼å¯¹åº”è¦å¤„ç†çš„controllerçš„æ–¹æ³•ï¼ŒäºŒç»´å¯¹åº”å…·ä½“è§„åˆ™å’Œæ¶ˆæ¯ã€‚å¼•ç”¨ValidatorMiddlewareä¸­é—´ä»¶ç»Ÿä¸€å¤„ç†æ¥å£è¯·æ±‚ï¼Œé€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸ç±»å¤„ç†é”™è¯¯è¿”å›ã€‚</p>
</blockquote>

<p>å‚è€ƒäº†Laravel Chinaç¤¾åŒºå„ä½å¤§ç¥çš„è®¾è®¡ï¼Œç»“åˆäº†ä¸‹è‡ªå·±é¡¹ç›®ä¸­çš„åœºæ™¯ï¼Œè®¾è®¡äº†ä»¥ä¸Šæ–¹æ¡ˆï¼Œæ¬¢è¿å¤§å®¶æ‹ç –ã€‚</p>

<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://laravel-china.org/topics/3137/design-of-shared-verification-rule-layer" target="_blank">https://laravel-china.org/topics/3137/design-of-shared-verification-rule-layer</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>phpé€šè¿‡å®šä¹‰JSON Schemaæ¥æ ¡éªŒå¯¹åº”JSONçš„æ ¼å¼æ•°æ®</title>
            <link>/posts/2017/03/01/json-schema-validate/</link>
            <pubDate>Wed, 01 Mar 2017 00:00:00 +0000</pubDate>
            
            <guid>/posts/2017/03/01/json-schema-validate/</guid>
            <description>æœ€è¿‘é¡¹ç›®ä¸­é‡åˆ°çš„éœ€æ±‚ï¼Œå¯¹äºæŸJSONç±»å‹çš„å­—æ®µï¼Œè¦åšéªŒè¯çš„æ ¼å¼æ ¡éªŒï¼Œå¹¶ä¸”æ ‡å‡ºé”™è¯¯çš„åœ°æ–¹ã€‚
æœ¬ç€ä¸è¦é‡å¤é€ è½®å­çš„åŸåˆ™ï¼Œåœ¨githubä¸Šæ‰¾åˆ°äº†è¿™ä¸ªé¡¹ç›®
 é€šè¿‡å®šä¹‰å›ºå®šæ ¼å¼çš„JSON Schemaæ¥éªŒè¯å¯¹åº”æ ¼å¼çš„æ•°æ®ã€‚
https://github.com/justinrainbow/json-schema
 å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å°±ä¸å¤šè¯´å•¦ï¼Œé€šè¿‡composerå®‰è£…ï¼Œå‚ç…§ç¤ºä¾‹å°±å¥½ã€‚
ä¸»è¦è¯´ä¸€ä¸‹JSON Schemaæ–‡ä»¶çš„å®šä¹‰é—®é¢˜ï¼ŒğŸ‘‡ç»“åˆä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä¾‹å­æ¥è¯´ä¸€ä¸‹Schemaå„ä¸ªå‚æ•°çš„ä½œç”¨
{ &amp;#34;title&amp;#34;: &amp;#34;Product set&amp;#34;, &amp;#34;type&amp;#34;: &amp;#34;array&amp;#34;, //åŸæ•°æ®æ ¼å¼ä¸ºæ•°ç»„ &amp;#34;minItems&amp;#34;: 1, //æœ€å°‘1ä¸ªå…ƒç´  &amp;#34;maxItems&amp;#34;: 10, //æœ€å¤š10ä¸ªå…ƒç´  &amp;#34;uniqueItems&amp;#34;: true, //æ•°æ®é‡å¤åˆ¤æ–­ &amp;#34;items&amp;#34;: { &amp;#34;title&amp;#34;: &amp;#34;Product&amp;#34;, &amp;#34;type&amp;#34;: &amp;#34;object&amp;#34;, //æ•°ç»„å…ƒç´ çš„å€¼ä¸ºå¯¹è±¡ &amp;#34;properties&amp;#34;: { &amp;#34;id&amp;#34;: { &amp;#34;description&amp;#34;: &amp;#34;The unique identifier for a product&amp;#34;, //idå­—æ®µæè¿° &amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;, //idçš„ç±»å‹ä¸ºstring &amp;#34;pattern&amp;#34;: &amp;#34;^(\\([0-9]{3}\\))?[0-9]{3}-[0-9]{4}$&amp;#34; //éªŒè¯idæ˜¯å¦ç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™ }, &amp;#34;name&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;, //nameçš„ç±»å‹ä¸ºstring &amp;#34;maxLength&amp;#34;: 10 //æœ€å¤§é•¿åº¦ä¸º10 }, &amp;#34;url&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;, //urlçš„ç±»å‹ä¸ºstring &amp;#34;format&amp;#34;: &amp;#34;uri&amp;#34; //å¹¶ä¸”ç¬¦åˆURIè§„åˆ™ }, &amp;#34;price&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;number&amp;#34;, //priceçš„ç±»å‹ä¸ºnumber &amp;#34;minimum&amp;#34;: 0, //æœ€å°å€¼ä¸º0 &amp;#34;exclusiveMinimum&amp;#34;: true //è¯¥å­—æ®µä¸ºtrueæ—¶éªŒè¯price&amp;gt;0,falseæ—¶éªŒè¯price&amp;gt;=0 }, &amp;#34;tags&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;string&amp;#34;, //tagsçš„ç±»å‹ä¸ºstring &amp;#34;enum&amp;#34;: [ //å¹¶ä¸”å€¼ä¸ºenumä¸­ä¹‹ä¸€ &amp;#34;food&amp;#34;, &amp;#34;fruit&amp;#34;, &amp;#34;juice&amp;#34; ] } }, &amp;#34;additionalProperties&amp;#34;: false, //ä¸å…è®¸é™¤äº†items.</description>
            <content type="html"><![CDATA[<p>æœ€è¿‘é¡¹ç›®ä¸­é‡åˆ°çš„éœ€æ±‚ï¼Œå¯¹äºæŸJSONç±»å‹çš„å­—æ®µï¼Œè¦åšéªŒè¯çš„æ ¼å¼æ ¡éªŒï¼Œå¹¶ä¸”æ ‡å‡ºé”™è¯¯çš„åœ°æ–¹ã€‚</p>

<p>æœ¬ç€ä¸è¦é‡å¤é€ è½®å­çš„åŸåˆ™ï¼Œåœ¨githubä¸Šæ‰¾åˆ°äº†è¿™ä¸ªé¡¹ç›®</p>

<blockquote>
<p>é€šè¿‡å®šä¹‰å›ºå®šæ ¼å¼çš„JSON Schemaæ¥éªŒè¯å¯¹åº”æ ¼å¼çš„æ•°æ®ã€‚<br><a href="https://github.com/justinrainbow/json-schema" target="_blank">https://github.com/justinrainbow/json-schema</a></p>
</blockquote>

<p>å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å°±ä¸å¤šè¯´å•¦ï¼Œé€šè¿‡composerå®‰è£…ï¼Œå‚ç…§ç¤ºä¾‹å°±å¥½ã€‚</p>

<p>ä¸»è¦è¯´ä¸€ä¸‹JSON Schemaæ–‡ä»¶çš„å®šä¹‰é—®é¢˜ï¼ŒğŸ‘‡ç»“åˆä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä¾‹å­æ¥è¯´ä¸€ä¸‹Schemaå„ä¸ªå‚æ•°çš„ä½œç”¨</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Product set&#34;</span>,
    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;array&#34;</span>,    <span style="color:#960050;background-color:#1e0010">//åŸæ•°æ®æ ¼å¼ä¸ºæ•°ç»„</span>
    <span style="color:#f92672">&#34;minItems&#34;</span>: <span style="color:#ae81ff">1</span>,  <span style="color:#960050;background-color:#1e0010">//æœ€å°‘1ä¸ªå…ƒç´ </span>
    <span style="color:#f92672">&#34;maxItems&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#960050;background-color:#1e0010">//æœ€å¤š10ä¸ªå…ƒç´ </span>
    <span style="color:#f92672">&#34;uniqueItems&#34;</span>: <span style="color:#66d9ef">true</span>,    <span style="color:#960050;background-color:#1e0010">//æ•°æ®é‡å¤åˆ¤æ–­</span>
    <span style="color:#f92672">&#34;items&#34;</span>: {
        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;Product&#34;</span>,
        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,   <span style="color:#960050;background-color:#1e0010">//æ•°ç»„å…ƒç´ çš„å€¼ä¸ºå¯¹è±¡</span>
        <span style="color:#f92672">&#34;properties&#34;</span>: {
            <span style="color:#f92672">&#34;id&#34;</span>: {
                <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The unique identifier for a product&#34;</span>,   <span style="color:#960050;background-color:#1e0010">//idå­—æ®µæè¿°</span>
                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,   <span style="color:#960050;background-color:#1e0010">//idçš„ç±»å‹ä¸ºstring</span>
                <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^(\\([0-9]{3}\\))?[0-9]{3}-[0-9]{4}$&#34;</span>   <span style="color:#960050;background-color:#1e0010">//éªŒè¯idæ˜¯å¦ç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™</span>
            },
            <span style="color:#f92672">&#34;name&#34;</span>: {
                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,    <span style="color:#960050;background-color:#1e0010">//nameçš„ç±»å‹ä¸ºstring</span>
                <span style="color:#f92672">&#34;maxLength&#34;</span>: <span style="color:#ae81ff">10</span> <span style="color:#960050;background-color:#1e0010">//æœ€å¤§é•¿åº¦ä¸º</span><span style="color:#ae81ff">10</span>
            },
            <span style="color:#f92672">&#34;url&#34;</span>: {
                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,   <span style="color:#960050;background-color:#1e0010">//urlçš„ç±»å‹ä¸ºstring</span>
                <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;uri&#34;</span> <span style="color:#960050;background-color:#1e0010">//å¹¶ä¸”ç¬¦åˆURIè§„åˆ™</span>
            },
            <span style="color:#f92672">&#34;price&#34;</span>: {
                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;number&#34;</span>,   <span style="color:#960050;background-color:#1e0010">//priceçš„ç±»å‹ä¸ºnumber</span>
                <span style="color:#f92672">&#34;minimum&#34;</span>: <span style="color:#ae81ff">0</span>,   <span style="color:#960050;background-color:#1e0010">//æœ€å°å€¼ä¸º0</span>
                <span style="color:#f92672">&#34;exclusiveMinimum&#34;</span>: <span style="color:#66d9ef">true</span>    <span style="color:#960050;background-color:#1e0010">//è¯¥å­—æ®µä¸ºtrueæ—¶éªŒè¯price&gt;</span><span style="color:#ae81ff">0</span>,<span style="color:#960050;background-color:#1e0010">falseæ—¶éªŒè¯price&gt;=0</span>
            },
            <span style="color:#f92672">&#34;tags&#34;</span>: {
                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,   <span style="color:#960050;background-color:#1e0010">//tagsçš„ç±»å‹ä¸ºstring</span>
                <span style="color:#f92672">&#34;enum&#34;</span>: [   <span style="color:#960050;background-color:#1e0010">//å¹¶ä¸”å€¼ä¸ºenumä¸­ä¹‹ä¸€</span>
                    <span style="color:#e6db74">&#34;food&#34;</span>,
                    <span style="color:#e6db74">&#34;fruit&#34;</span>,
                    <span style="color:#e6db74">&#34;juice&#34;</span>
                ]
            }
        },
        <span style="color:#f92672">&#34;additionalProperties&#34;</span>: <span style="color:#66d9ef">false</span>, <span style="color:#960050;background-color:#1e0010">//ä¸å…è®¸é™¤äº†items.propertieså®šä¹‰ä»¥å¤–çš„å­—æ®µ</span>
        <span style="color:#f92672">&#34;required&#34;</span>: [<span style="color:#e6db74">&#34;id&#34;</span>, <span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;price&#34;</span>] <span style="color:#960050;background-color:#1e0010">//id</span>,<span style="color:#960050;background-color:#1e0010">name,priceå­—æ®µå¿…å¡«</span>
    }
}</code></pre></div>
<p>è¿˜æœ‰æ›´è¯¦ç»†çš„JSON Schemaæ–‡æ¡£è¯´æ˜è§ä»¥ä¸‹å‚è€ƒé“¾æ¥</p>

<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://github.com/justinrainbow/json-schema" target="_blank">https://github.com/justinrainbow/json-schema</a></li>
<li><a href="http://json-schema.org/" target="_blank">http://json-schema.org/</a>]</li>
<li><a href="https://spacetelescope.github.io/understanding-json-schema/index.html" target="_blank">https://spacetelescope.github.io/understanding-json-schema/index.html</a>]</li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>åŸºäºLumenæ¡†æ¶æ„å»ºåŸºç¡€çš„Web APIæœåŠ¡</title>
            <link>/posts/2017/02/10/imooc-lumen-api/</link>
            <pubDate>Fri, 10 Feb 2017 00:00:00 +0000</pubDate>
            
            <guid>/posts/2017/02/10/imooc-lumen-api/</guid>
            <description>å·§åˆä¸‹è·Ÿæ…•è¯¾ç½‘æœ‰è¿‡åˆä½œï¼Œè™½ç„¶åæ¥å› ä¸ºä¸ªäººå·¥ä½œæ—¶é—´çš„å…³ç³»æ²¡æœ‰æ·±å…¥è¿›è¡Œä¸‹å»ï¼Œä½†æ˜¯ä¹Ÿç®—å€Ÿç€è¿™ä¸ªæœºä¼šé”»ç‚¼ä¸€ä¸‹è‡ªå·±ï¼Œæ¢³ç†äº†ä¸‹è‡ªå·±æ‰€æŒæ¡çš„çŸ¥è¯†ï¼Œåœ¨è¿™é‡Œè·Ÿå¤§å®¶åšä¸ªåˆ†äº«ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ•™ã€‚</description>
            <content type="html"><![CDATA[<p>å·§åˆä¸‹è·Ÿæ…•è¯¾ç½‘æœ‰è¿‡åˆä½œï¼Œè™½ç„¶åæ¥å› ä¸ºä¸ªäººå·¥ä½œæ—¶é—´çš„å…³ç³»æ²¡æœ‰æ·±å…¥è¿›è¡Œä¸‹å»ï¼Œä½†æ˜¯ä¹Ÿç®—å€Ÿç€è¿™ä¸ªæœºä¼šé”»ç‚¼ä¸€ä¸‹è‡ªå·±ï¼Œæ¢³ç†äº†ä¸‹è‡ªå·±æ‰€æŒæ¡çš„çŸ¥è¯†ï¼Œåœ¨è¿™é‡Œè·Ÿå¤§å®¶åšä¸ªåˆ†äº«ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ•™ã€‚</p>

<p><embed src="//player.video.iqiyi.com/525b2979bc32af62bcf87e061b2efabd/0/0/w_19rtzde32t.swf-albumId=7525586809-tvId=7525586809-isPurchase=0-cnId=undefined" allowFullScreen="true" quality="high" width="480" height="350" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></p>
]]></content>
        </item>
        
        <item>
            <title>PHPæœ€ä½³å®è·µï¼Œè§„èŒƒï¼Œç›¸å…³èµ„æºæ•´ç†</title>
            <link>/posts/2017/01/03/php-doc/</link>
            <pubDate>Tue, 03 Jan 2017 00:00:00 +0000</pubDate>
            
            <guid>/posts/2017/01/03/php-doc/</guid>
            <description>æ ‡è®°æ•´ç†ä¸‹ä¹¦ç­¾
 PHP
 PHP æ‰‹å†Œ PHP The Right Way PHP-FIG PSRä¸­æ–‡ç‰ˆ  Laravel
 Laravel China Laravel çš„ä¸­å¤§å‹å°ˆæ¡ˆæ¶æ§‹ èƒ–èƒ–Modelæ¸›é‡çš„äº”å€‹æ–¹æ³•  Tools &amp;amp;&amp;amp; Docs
 å¯¹ REST çš„ç†è§£ Mastering Markdown Awesome Mac APIDOC ç®€æ˜ VIM ç»ƒçº§æ”»ç•¥   æŒç»­æ›´æ–°</description>
            <content type="html"><![CDATA[<p>æ ‡è®°æ•´ç†ä¸‹ä¹¦ç­¾</p>

<ul>
<li><p>PHP</p>

<ul>
<li><a href="http://php.net/manual/zh/" target="_blank">PHP æ‰‹å†Œ</a></li>
<li><a href="http://laravel-china.github.io/php-the-right-way/" target="_blank">PHP The Right Way</a></li>
<li><a href="https://github.com/PizzaLiu/PHP-FIG" target="_blank">PHP-FIG PSRä¸­æ–‡ç‰ˆ</a></li>
</ul></li>

<li><p>Laravel</p>

<ul>
<li><a href="https://laravel-china.org/" target="_blank">Laravel China</a></li>
<li><a href="http://oomusou.io/laravel/laravel-architecture/" target="_blank">Laravel çš„ä¸­å¤§å‹å°ˆæ¡ˆæ¶æ§‹</a></li>
<li><a href="http://slides.com/howtomakeaturn/model#/" target="_blank">èƒ–èƒ–Modelæ¸›é‡çš„äº”å€‹æ–¹æ³•</a></li>
</ul></li>

<li><p>Tools &amp;&amp; Docs</p>

<ul>
<li><a href="http://blog.lyyw.info/2017/02/09/2017-02-09%20%E5%AF%B9rest%E7%9A%84%E7%90%86%E8%A7%A3/" target="_blank">å¯¹ REST çš„ç†è§£</a></li>
<li><a href="https://guides.github.com/features/mastering-markdown/" target="_blank">Mastering Markdown</a></li>
<li><a href="https://jaywcjlove.github.io/awesome-mac/index.zh.html" target="_blank">Awesome Mac</a></li>
<li><a href="http://apidocjs.com/" target="_blank">APIDOC</a></li>
<li><a href="http://coolshell.cn/articles/5426.html" target="_blank">ç®€æ˜ VIM ç»ƒçº§æ”»ç•¥</a></li>
</ul></li>
</ul>

<p><em>æŒç»­æ›´æ–°</em></p>
]]></content>
        </item>
        
        <item>
            <title>ä¸€é“æœ‰å…³MySQLæŸ¥è¯¢è¯­å¥çš„é¢è¯•é¢˜</title>
            <link>/posts/2016/10/10/mysql-query/</link>
            <pubDate>Mon, 10 Oct 2016 00:00:00 +0000</pubDate>
            
            <guid>/posts/2016/10/10/mysql-query/</guid>
            <description>æœ€è¿‘é—²æ¥æ— äº‹ï¼Œçªç„¶æƒ³èµ·æ¥ä¹‹å‰åœ¨ç¾¤é‡Œçœ‹åˆ°çš„ä¸€ä¸ªæœ‰å…³MySQLæŸ¥è¯¢è¯­å¥çš„é¢è¯•é¢˜ï¼Œè·Ÿå¤§å®¶åˆ†äº«ï¼Œé¡ºä¾¿ç•™ä½œå¤‡å¿˜ã€‚
åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š
    id data name date     1 30 kael 20160718   2 30 soul 20160720   3 66 kael 20160719   4 52 soul 20160719   5 99 kael 20160720   6 82 soul 20160718     å¸Œæœ›é€šè¿‡SQLè¯­å¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š
    name Data_18 Data_19 Data_20     kael 30 66 99   soul 82 52 30     å¤ªä¹…æ²¡å†™åŸç”ŸæŸ¥è¯¢è¯­å¥ï¼Œæš‚æ—¶æƒ³åˆ°çš„SQLè¯­å¥å¦‚ä¸‹ï¼š</description>
            <content type="html"><![CDATA[<p>æœ€è¿‘é—²æ¥æ— äº‹ï¼Œçªç„¶æƒ³èµ·æ¥ä¹‹å‰åœ¨ç¾¤é‡Œçœ‹åˆ°çš„ä¸€ä¸ªæœ‰å…³MySQLæŸ¥è¯¢è¯­å¥çš„é¢è¯•é¢˜ï¼Œè·Ÿå¤§å®¶åˆ†äº«ï¼Œé¡ºä¾¿ç•™ä½œå¤‡å¿˜ã€‚</p>

<p>åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š</p>

<blockquote>
<table>
<thead>
<tr>
<th align="center">id</th>
<th align="center">data</th>
<th align="center">name</th>
<th align="center">date</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">1</td>
<td align="center">30</td>
<td align="center">kael</td>
<td align="center">20160718</td>
</tr>

<tr>
<td align="center">2</td>
<td align="center">30</td>
<td align="center">soul</td>
<td align="center">20160720</td>
</tr>

<tr>
<td align="center">3</td>
<td align="center">66</td>
<td align="center">kael</td>
<td align="center">20160719</td>
</tr>

<tr>
<td align="center">4</td>
<td align="center">52</td>
<td align="center">soul</td>
<td align="center">20160719</td>
</tr>

<tr>
<td align="center">5</td>
<td align="center">99</td>
<td align="center">kael</td>
<td align="center">20160720</td>
</tr>

<tr>
<td align="center">6</td>
<td align="center">82</td>
<td align="center">soul</td>
<td align="center">20160718</td>
</tr>
</tbody>
</table>
</blockquote>

<p>å¸Œæœ›é€šè¿‡SQLè¯­å¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>

<blockquote>
<table>
<thead>
<tr>
<th align="center">name</th>
<th align="center">Data_18</th>
<th align="center">Data_19</th>
<th align="center">Data_20</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">kael</td>
<td align="center">30</td>
<td align="center">66</td>
<td align="center">99</td>
</tr>

<tr>
<td align="center">soul</td>
<td align="center">82</td>
<td align="center">52</td>
<td align="center">30</td>
</tr>
</tbody>
</table>
</blockquote>

<p>å¤ªä¹…æ²¡å†™åŸç”ŸæŸ¥è¯¢è¯­å¥ï¼Œæš‚æ—¶æƒ³åˆ°çš„SQLè¯­å¥å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> name,
(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">data</span> <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span>test<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> t1 <span style="color:#66d9ef">WHERE</span> t1.name <span style="color:#f92672">=</span> t.name <span style="color:#66d9ef">AND</span> date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;20160718&#39;</span>) <span style="color:#66d9ef">AS</span> Data_18,
(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">data</span> <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span>test<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> t2 <span style="color:#66d9ef">WHERE</span> t2.name <span style="color:#f92672">=</span> t.name <span style="color:#66d9ef">AND</span> date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;20160719&#39;</span>) <span style="color:#66d9ef">AS</span> Data_19,
(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">data</span> <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span>test<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> t3 <span style="color:#66d9ef">WHERE</span> t3.name <span style="color:#f92672">=</span> t.name <span style="color:#66d9ef">AND</span> date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;20160720&#39;</span>) <span style="color:#66d9ef">AS</span> Data_20
<span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span>test<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> t <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> name</code></pre></div>
<p>PS: å¦‚æœæœ‰æ›´å¥½çš„æƒ³æ³•ï¼Œæ¬¢è¿ä¸æˆ‘äº¤æµã€‚</p>
]]></content>
        </item>
        
        <item>
            <title>Lumenæ¡†æ¶åœ¨åŒä¸€åŸŸåå¤šåº”ç”¨ç¯å¢ƒä¸‹çš„éƒ¨ç½²é—®é¢˜</title>
            <link>/posts/2016/08/25/lumen-application/</link>
            <pubDate>Thu, 25 Aug 2016 00:00:00 +0000</pubDate>
            
            <guid>/posts/2016/08/25/lumen-application/</guid>
            <description> åœ¨åŒä¸€åŸŸåä¸‹éƒ¨ç½²å¤šä¸ªåº”ç”¨æ—¶ï¼Œä½¿ç”¨Lumenæ¡†æ¶é‡åˆ°çš„é—®é¢˜ å®˜æ–¹æ–‡æ¡£çš„æ¨èä¸€èˆ¬æ˜¯é€šè¿‡é…ç½®ç½‘ç«™çš„æ ¹ç›®å½•è‡³wwwroot/LUMEN/public/ã€‚å¦‚æœæœåŠ¡å™¨ä¸Šåªæœ‰Lumenä¸€ä¸ªåº”ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœæœåŠ¡å™¨ä¸ŠåŒæ—¶éƒ¨ç½²äº†å¤šä¸ªåº”ç”¨ï¼Œæƒ³é€šè¿‡wwwrootçš„ç›¸å¯¹è·¯å¾„http://DOMAIN/lumen/public/æ¥è®¿é—®æ¡†æ¶urlæ—¶å°±ä¼šå‡ºç°NotFoundHttpExceptionçš„å¼‚å¸¸ã€‚
æ ¹æ®é”™è¯¯æç¤ºï¼Œå®šä½åˆ°æ–‡ä»¶LUMEN/vendor/laravel/lumen-framework/src/Concerns/RegistersExceptionHandlers.phpä¸­370è¡Œï¼š
æ¡†æ¶ä¸­çš„LUMEN/public/index.phpé»˜è®¤æ˜¯$app-&amp;gt;run();æ˜¯ä¸ä¼ $requestçš„ï¼Œå¯¹åº”è°ƒç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š
å¯è§é€šè¿‡æ­¤æ–¹æ³•è·å–çš„pathï¼Œå¦‚æœå­˜åœ¨å¤šåº”ç”¨çš„æƒ…å†µä¸‹ï¼Œ$this-&amp;gt;routesè·å–æ˜¯é”™è¯¯çš„ã€‚
è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š ä¿®æ”¹LUMEN/public/index.phpä¸º
$request = Illuminate\Http\Request::capture(); $app-&amp;gt;run($request); å‚è€ƒ
 https://segmentfault.com/a/1190000002724037 https://segmentfault.com/a/1190000004460637 http://stackoverflow.com/questions/29728973/notfoundhttpexception-with-lumen  </description>
            <content type="html"><![CDATA[

<h3 id="åœ¨åŒä¸€åŸŸåä¸‹éƒ¨ç½²å¤šä¸ªåº”ç”¨æ—¶-ä½¿ç”¨lumenæ¡†æ¶é‡åˆ°çš„é—®é¢˜"><strong>åœ¨åŒä¸€åŸŸåä¸‹éƒ¨ç½²å¤šä¸ªåº”ç”¨æ—¶ï¼Œä½¿ç”¨Lumenæ¡†æ¶é‡åˆ°çš„é—®é¢˜</strong></h3>

<p>å®˜æ–¹æ–‡æ¡£çš„æ¨èä¸€èˆ¬æ˜¯é€šè¿‡é…ç½®ç½‘ç«™çš„æ ¹ç›®å½•è‡³<code>wwwroot/LUMEN/public/</code>ã€‚å¦‚æœæœåŠ¡å™¨ä¸Šåªæœ‰Lumenä¸€ä¸ªåº”ç”¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœæœåŠ¡å™¨ä¸ŠåŒæ—¶éƒ¨ç½²äº†å¤šä¸ªåº”ç”¨ï¼Œæƒ³é€šè¿‡<code>wwwroot</code>çš„ç›¸å¯¹è·¯å¾„<code>http://DOMAIN/lumen/public/</code>æ¥è®¿é—®æ¡†æ¶urlæ—¶å°±ä¼šå‡ºç°<code>NotFoundHttpException</code>çš„å¼‚å¸¸ã€‚</p>

<p>æ ¹æ®é”™è¯¯æç¤ºï¼Œå®šä½åˆ°æ–‡ä»¶<code>LUMEN/vendor/laravel/lumen-framework/src/Concerns/RegistersExceptionHandlers.php</code>ä¸­370è¡Œï¼š</p>


    <img src="/assets/images/lumen-application-1.jpg"  data-action="zoom" alt="lumen-application-1"  class="center"  />



    <img src="/assets/images/lumen-application-2.jpg"  data-action="zoom" alt="lumen-application-2"  class="center"  />


<p>æ¡†æ¶ä¸­çš„LUMEN/public/index.phpé»˜è®¤æ˜¯<code>$app-&gt;run();</code>æ˜¯ä¸ä¼ $requestçš„ï¼Œå¯¹åº”è°ƒç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>


    <img src="/assets/images/lumen-application-3.jpg"  data-action="zoom" alt="lumen-application-3"  class="center"  />


<p>å¯è§é€šè¿‡æ­¤æ–¹æ³•è·å–çš„pathï¼Œå¦‚æœå­˜åœ¨å¤šåº”ç”¨çš„æƒ…å†µä¸‹ï¼Œ$this-&gt;routesè·å–æ˜¯é”™è¯¯çš„ã€‚</p>

<h3 id="è§£å†³æ–¹æ³•å¦‚ä¸‹"><strong>è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</strong></h3>

<p>ä¿®æ”¹<code>LUMEN/public/index.php</code>ä¸º</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$request = Illuminate\Http\Request::capture();
$app-&gt;run($request);</code></pre></div>
<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="https://segmentfault.com/a/1190000002724037" target="_blank">https://segmentfault.com/a/1190000002724037</a></li>
<li><a href="https://segmentfault.com/a/1190000004460637" target="_blank">https://segmentfault.com/a/1190000004460637</a></li>
<li><a href="http://stackoverflow.com/questions/29728973/notfoundhttpexception-with-lumen" target="_blank">http://stackoverflow.com/questions/29728973/notfoundhttpexception-with-lumen</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>PHPä½¿ç”¨CURLè®¿é—®HTTPS</title>
            <link>/posts/2016/08/08/php-curl-https/</link>
            <pubDate>Mon, 08 Aug 2016 00:00:00 +0000</pubDate>
            
            <guid>/posts/2016/08/08/php-curl-https/</guid>
            <description>æœ€è¿‘æ–°ä¸Šçº¿çš„é¡¹ç›®å‡†å¤‡å‡çº§æœåŠ¡æ”¯æŒhttpsè®¿é—®ï¼Œè®°å½•ä¸‹ä½¿ç”¨curlæ–¹æ³•è®¿é—®httpsæ—¶é‡åˆ°çš„é—®é¢˜ã€‚
ç›´æ¥ä¸Šä»£ç :
function post($url, $param) { $ssl = substr($url, 0, 8) == &amp;#34;https://&amp;#34; ? true : false; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); if ($ssl) { curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // ä¿¡ä»»ä»»ä½•è¯ä¹¦ curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); // æ£€æŸ¥è¯ä¹¦ä¸­æ˜¯å¦è®¾ç½®åŸŸå // $cacert = getcwd() . &amp;#39;/cacert.pem&amp;#39;; //CAæ ¹è¯ä¹¦ // curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true); // åªä¿¡ä»»CAé¢å¸ƒçš„è¯ä¹¦ // curl_setopt($ch, CURLOPT_CAINFO, $cacert); // CAæ ¹è¯ä¹¦ï¼ˆç”¨æ¥éªŒè¯çš„ç½‘ç«™è¯ä¹¦æ˜¯å¦æ˜¯CAé¢å¸ƒï¼‰ // curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2); // æ£€æŸ¥è¯ä¹¦ä¸­æ˜¯å¦è®¾ç½®åŸŸåï¼Œå¹¶ä¸”æ˜¯å¦ä¸æä¾›çš„ä¸»æœºååŒ¹é… } curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_POST, true); curl_setopt($ch, CURLOPT_POSTFIELDS, $param); $return = curl_exec($ch); curl_close($ch); return $return; } ç®€å•æ¥è¯´è®¿é—®httpsæ—¶ï¼Œåªè¦æŒ‡å®šCURLOPT_SSL_VERIFYPEERå’ŒCURLOPT_SSL_VERIFYHOSTä¸ºfalseå°±èƒ½æ”¯æŒè®¿é—®äº†ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸‹è½½å¯¹åº”çš„æ ¹è¯ä¹¦ï¼Œç„¶ååœ¨è¯·æ±‚ä¸­å¸¦ä¸Šè®¿é—®ä¹Ÿå¯ä»¥ã€‚</description>
            <content type="html"><![CDATA[<p>æœ€è¿‘æ–°ä¸Šçº¿çš„é¡¹ç›®å‡†å¤‡å‡çº§æœåŠ¡æ”¯æŒhttpsè®¿é—®ï¼Œè®°å½•ä¸‹ä½¿ç”¨curlæ–¹æ³•è®¿é—®httpsæ—¶é‡åˆ°çš„é—®é¢˜ã€‚</p>

<p>ç›´æ¥ä¸Šä»£ç :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">function post($url, $param)
{
    $ssl = substr($url, 0, 8) == &#34;https://&#34; ? true : false;
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    if ($ssl) {
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // ä¿¡ä»»ä»»ä½•è¯ä¹¦
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); // æ£€æŸ¥è¯ä¹¦ä¸­æ˜¯å¦è®¾ç½®åŸŸå

        // $cacert = getcwd() . &#39;/cacert.pem&#39;; //CAæ ¹è¯ä¹¦
        // curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);   // åªä¿¡ä»»CAé¢å¸ƒçš„è¯ä¹¦
        // curl_setopt($ch, CURLOPT_CAINFO, $cacert); // CAæ ¹è¯ä¹¦ï¼ˆç”¨æ¥éªŒè¯çš„ç½‘ç«™è¯ä¹¦æ˜¯å¦æ˜¯CAé¢å¸ƒï¼‰
        // curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2); // æ£€æŸ¥è¯ä¹¦ä¸­æ˜¯å¦è®¾ç½®åŸŸåï¼Œå¹¶ä¸”æ˜¯å¦ä¸æä¾›çš„ä¸»æœºååŒ¹é…
    }
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $param);

    $return = curl_exec($ch);

    curl_close($ch);
    return $return;
}</code></pre></div>
<p>ç®€å•æ¥è¯´è®¿é—®httpsæ—¶ï¼Œåªè¦æŒ‡å®š<code>CURLOPT_SSL_VERIFYPEER</code>å’Œ<code>CURLOPT_SSL_VERIFYHOST</code>ä¸º<code>false</code>å°±èƒ½æ”¯æŒè®¿é—®äº†ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸‹è½½å¯¹åº”çš„æ ¹è¯ä¹¦ï¼Œç„¶ååœ¨è¯·æ±‚ä¸­å¸¦ä¸Šè®¿é—®ä¹Ÿå¯ä»¥ã€‚</p>

<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="http://php.net/manual/zh/function.curl-setopt.php" target="_blank">http://php.net/manual/zh/function.curl-setopt.php</a></li>
<li><a href="http://blog.csdn.net/linvo/article/details/8816079" target="_blank">http://blog.csdn.net/linvo/article/details/8816079</a></li>
<li><a href="http://unitstep.net/blog/2009/05/05/using-curl-in-php-to-access-https-ssltls-protected-sites" target="_blank">http://unitstep.net/blog/2009/05/05/using-curl-in-php-to-access-https-ssltls-protected-sites</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Lumen / Laravel .env</title>
            <link>/posts/2016/07/20/lumen-env/</link>
            <pubDate>Wed, 20 Jul 2016 00:00:00 +0000</pubDate>
            
            <guid>/posts/2016/07/20/lumen-env/</guid>
            <description> æœ€è¿‘åœ¨ä½¿ç”¨Lumenæ¡†æ¶éƒ¨ç½²ä¸Šçº¿æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ Lumen / Laravel ä¸­çš„.envæ–‡ä»¶é‡Œä¸€èˆ¬é…ç½®ç€å„ç§ç¯å¢ƒæ‰€å¯¹åº”çš„é…ç½®ï¼Œä¾‹å¦‚ï¼šdbï¼Œcacheç­‰é…ç½®ï¼Œå®˜æ–¹çš„æ¨èæ˜¯ç‰ˆæœ¬åº“ä¸­ä¿ç•™ä¸€ä¸ª.env.exampleï¼Œå„ä¸ªç¯å¢ƒcp .env.exampleçš„é…ç½®å¹¶é…ä¸Šå¯¹åº”ç¯å¢ƒçš„é…ç½®ç”Ÿæˆ.envæ–‡ä»¶ï¼Œå®Œæˆé¡¹ç›®çš„éƒ¨ç½²ã€‚
ä½†å®é™…åº”ç”¨ä¸­ä¼šé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå°´å°¬çš„é—®é¢˜æ˜¯ï¼šå¦‚æœæ–°å¢æˆ–ä¿®æ”¹äº†é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨åˆ°å¯¹åº”ç¯å¢ƒä¸Šå»æ”¹é…ç½®ï¼Œä¸€èˆ¬çš„æµ‹è¯•æˆ–è€…å¼€å‘ç¯å¢ƒè¿˜å¥½ï¼Œä½†æ˜¯å¯¹åº”çº¿ä¸Šç”Ÿäº§æˆ–è€…é¢„å‘å¸ƒç¯å¢ƒï¼Œä¸€èˆ¬æ˜¯ä¸å…è®¸æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶çš„ã€‚è€Œä¸”ä¹Ÿæœ‰å¯èƒ½çº¿ä¸Šçš„æœºå™¨è¾ƒå¤šï¼Œæ‰‹åŠ¨ä¸€ä¸ªä¸ªå»æ“ä½œä¸æ–¹ä¾¿ä¹Ÿä¸å®‰å…¨ã€‚è€Œä¸”åƒç°åœ¨ä¸€èˆ¬ä¹Ÿéƒ½æ˜¯ä½¿ç”¨è‡ªåŠ¨åŒ–ä¸Šçº¿å·¥å…·ï¼Œæ‹‰ç‰ˆæœ¬åº“ä»£ç ç›´æ¥ä¸Šçº¿ï¼Œæ­¤æ—¶å®˜æ–¹æ¨èçš„åšæ³•å°±ä¸æ˜¯å¾ˆé€‚ç”¨äº†ã€‚
æ—¢ç„¶æ»¡è¶³ä¸äº†è‡ªå·±çš„éœ€æ±‚ï¼Œé‚£å°±ç¨å¾®æ”¹é€ ä¸€ä¸‹å§ã€‚ åˆæ­¥çš„æ€è·¯æ˜¯: æŠŠå„ä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶éƒ½æ”¾åˆ°ç‰ˆæœ¬åº“é‡Œï¼Œç„¶åä»£ç é‡Œåˆ¤æ–­å‡ºå„ä¸ªç¯å¢ƒï¼ŒåŠ è½½å¯¹åº”çš„ç¯å¢ƒé…ç½®ã€‚
é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹lumenæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Œé€šè¿‡åˆ†ælumençš„å…¥å£æ–‡ä»¶LUMEN/public/idnex.phpï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒå¼•ç”¨äº† LUMEN/bootstrap/app.php è¿™ä¸ªæ–‡ä»¶ã€‚ ç„¶ååœ¨LUMEN/bootstrap/app.phpä¸­ï¼Œå®Œæˆäº†Dotenvç±»çš„åˆå§‹åŒ– é€šè¿‡æŸ¥çœ‹Dotenvç±»çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ„é€ å‡½æ•°çš„ä¿©ä¸ªå‚æ•°çš„å«ä¹‰
 .envæ–‡ä»¶æ‰€åœ¨çš„ç›®å½• æ–‡ä»¶å  äº†è§£äº†å¦‚ä¸Šçš„ä¿¡æ¯åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è‡ªå·±çš„æ”¹åŠ¨å•¦ã€‚ é¦–å…ˆåœ¨ç‰ˆæœ¬åº“é‡Œæ–°å»º
 .env.local .env.test .env.production  é€šè¿‡è·å¾—æœåŠ¡å™¨çš„hostnameæ¥å¾—åˆ°å¯¹åº”çš„ç¯å¢ƒï¼Œç„¶åloadå¯¹åº”çš„.envæ–‡ä»¶å°±å¥½äº†ã€‚
å‚è€ƒ
 http://developers.ph/laravel-framework/laravel-5/how-to-setup-multiple-environment-for-laravel-5-developers-way  </description>
            <content type="html"><![CDATA[

<h3 id="æœ€è¿‘åœ¨ä½¿ç”¨lumenæ¡†æ¶éƒ¨ç½²ä¸Šçº¿æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜"><strong>æœ€è¿‘åœ¨ä½¿ç”¨Lumenæ¡†æ¶éƒ¨ç½²ä¸Šçº¿æ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜</strong></h3>

<p>Lumen / Laravel ä¸­çš„.envæ–‡ä»¶é‡Œä¸€èˆ¬é…ç½®ç€å„ç§ç¯å¢ƒæ‰€å¯¹åº”çš„é…ç½®ï¼Œä¾‹å¦‚ï¼šdbï¼Œcacheç­‰é…ç½®ï¼Œå®˜æ–¹çš„æ¨èæ˜¯ç‰ˆæœ¬åº“ä¸­ä¿ç•™ä¸€ä¸ª.env.exampleï¼Œå„ä¸ªç¯å¢ƒcp .env.exampleçš„é…ç½®å¹¶é…ä¸Šå¯¹åº”ç¯å¢ƒçš„é…ç½®ç”Ÿæˆ.envæ–‡ä»¶ï¼Œå®Œæˆé¡¹ç›®çš„éƒ¨ç½²ã€‚</p>

<p>ä½†å®é™…åº”ç”¨ä¸­ä¼šé‡åˆ°ä¸€ä¸ªæ¯”è¾ƒå°´å°¬çš„é—®é¢˜æ˜¯ï¼šå¦‚æœæ–°å¢æˆ–ä¿®æ”¹äº†é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨åˆ°å¯¹åº”ç¯å¢ƒä¸Šå»æ”¹é…ç½®ï¼Œä¸€èˆ¬çš„æµ‹è¯•æˆ–è€…å¼€å‘ç¯å¢ƒè¿˜å¥½ï¼Œä½†æ˜¯å¯¹åº”çº¿ä¸Šç”Ÿäº§æˆ–è€…é¢„å‘å¸ƒç¯å¢ƒï¼Œä¸€èˆ¬æ˜¯ä¸å…è®¸æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶çš„ã€‚è€Œä¸”ä¹Ÿæœ‰å¯èƒ½çº¿ä¸Šçš„æœºå™¨è¾ƒå¤šï¼Œæ‰‹åŠ¨ä¸€ä¸ªä¸ªå»æ“ä½œä¸æ–¹ä¾¿ä¹Ÿä¸å®‰å…¨ã€‚è€Œä¸”åƒç°åœ¨ä¸€èˆ¬ä¹Ÿéƒ½æ˜¯ä½¿ç”¨è‡ªåŠ¨åŒ–ä¸Šçº¿å·¥å…·ï¼Œæ‹‰ç‰ˆæœ¬åº“ä»£ç ç›´æ¥ä¸Šçº¿ï¼Œæ­¤æ—¶å®˜æ–¹æ¨èçš„åšæ³•å°±ä¸æ˜¯å¾ˆé€‚ç”¨äº†ã€‚</p>

<p>æ—¢ç„¶æ»¡è¶³ä¸äº†è‡ªå·±çš„éœ€æ±‚ï¼Œé‚£å°±ç¨å¾®æ”¹é€ ä¸€ä¸‹å§ã€‚
åˆæ­¥çš„æ€è·¯æ˜¯: <strong>æŠŠå„ä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶éƒ½æ”¾åˆ°ç‰ˆæœ¬åº“é‡Œï¼Œç„¶åä»£ç é‡Œåˆ¤æ–­å‡ºå„ä¸ªç¯å¢ƒï¼ŒåŠ è½½å¯¹åº”çš„ç¯å¢ƒé…ç½®ã€‚</strong></p>

<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹lumenæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Œé€šè¿‡åˆ†ælumençš„å…¥å£æ–‡ä»¶<code>LUMEN/public/idnex.php</code>ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒå¼•ç”¨äº† <code>LUMEN/bootstrap/app.php</code> è¿™ä¸ªæ–‡ä»¶ã€‚

    <img src="/assets/images/lumen-index.jpg"  data-action="zoom" alt="lumen-index"  class="center"  />
</p>

<p>ç„¶ååœ¨LUMEN/bootstrap/app.phpä¸­ï¼Œå®Œæˆäº†Dotenvç±»çš„åˆå§‹åŒ–

    <img src="/assets/images/lumen-bootstrap-app.jpg"  data-action="zoom" alt="lumen-bootstrap-app"  class="center"  />
</p>

<p>é€šè¿‡æŸ¥çœ‹Dotenvç±»çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ„é€ å‡½æ•°çš„ä¿©ä¸ªå‚æ•°çš„å«ä¹‰</p>

<ol>
<li>.envæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</li>
<li>æ–‡ä»¶å</li>
</ol>


    <img src="/assets/images/lumen-phpdotenv.jpg"  data-action="zoom" alt="lumen-phpdotenv"  class="center"  />


<p>äº†è§£äº†å¦‚ä¸Šçš„ä¿¡æ¯åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è‡ªå·±çš„æ”¹åŠ¨å•¦ã€‚
é¦–å…ˆåœ¨ç‰ˆæœ¬åº“é‡Œæ–°å»º</p>

<ul>
<li>.env.local</li>
<li>.env.test</li>
<li>.env.production</li>
</ul>


    <img src="/assets/images/lumen-bootstrap-app-new.jpg"  data-action="zoom" alt="lumen-bootstrap-app-new"  class="center"  />


<p>é€šè¿‡è·å¾—æœåŠ¡å™¨çš„hostnameæ¥å¾—åˆ°å¯¹åº”çš„ç¯å¢ƒï¼Œç„¶åloadå¯¹åº”çš„.envæ–‡ä»¶å°±å¥½äº†ã€‚</p>

<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="http://developers.ph/laravel-framework/laravel-5/how-to-setup-multiple-environment-for-laravel-5-developers-way/" target="_blank">http://developers.ph/laravel-framework/laravel-5/how-to-setup-multiple-environment-for-laravel-5-developers-way</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Lumen CORS</title>
            <link>/posts/2016/06/30/lumen-cors/</link>
            <pubDate>Thu, 30 Jun 2016 00:00:00 +0000</pubDate>
            
            <guid>/posts/2016/06/30/lumen-cors/</guid>
            <description>ä½¿ç”¨Lumenæ¡†æ¶å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ è·¨åŸŸé—®é¢˜æƒ³å¿…æ˜¯æ¯ä¸ªä»äº‹webç›¸å…³å¼€å‘çš„åŒå­¦ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ç°åœ¨è¶Šæ¥è¶Šå¤šçš„åº”ç”¨é‡‡ç”¨çš„å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œæ‰€ä»¥è§£å†³è·¨åŸŸé—®é¢˜æˆäº†å¤§å®¶å¿…ä¸å¯å°‘çš„ä¸€é¡¹æŠ€èƒ½ã€‚æœ€è¿‘åœ¨ä½¿ç”¨Lumenæ¡†æ¶å¼€å‘æ—¶ä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚
è¿›å…¥ä¸»é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆæ¥ä¸ªé“ºå«ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Œä»¥åŠä¸€äº›è§£å†³æ–¹æ¡ˆ è¿™æ˜¯é“ºå«
æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä»”ç»†çœ‹çœ‹ï¼Œå…¶å®W3Cæ ‡å‡†çš„è§£å†³æ–¹æ¡ˆæ˜¯åªè¦åœ¨æœåŠ¡å™¨responseçš„å¤´éƒ¨å¸¦ä¸ŠAccess-Control-Allow-Originï¼šDOMAIN(å…è®¸è·¨åŸŸè®¿é—®çš„åŸŸåï¼Œ*ä»£è¡¨æ‰€æœ‰)ï¼Œä¸è¿‡éœ€è¦ä¸€æçš„æ˜¯è¯¥æ–¹æ¡ˆåªæ”¯æŒIE8åŠä»¥ä¸Šï¼Œä»¥åŠä¸€äº›ç°ä»£æµè§ˆå™¨(Fire Fox,Chrome,etc.)ã€‚è§£å†³è·¨åŸŸæ¯”è¾ƒå¸¸è§çš„è¿˜æœ‰ä½¿ç”¨jsonpï¼Œä½†è¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸å…·ä½“å±•å¼€äº†ã€‚
å¥½äº†ï¼Œä¸Šé¢å•°å—¦äº†é‚£ä¹ˆå¤šï¼Œä¸‹é¢è¿›å…¥ä¸»é¢˜ï¼Œé‚£ä¹ˆåœ¨Lumenæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆè§£å†³è·¨åŸŸé—®é¢˜å‘¢? è¿™è¾¹ä¸»è¦å‚è€ƒäº†è¿™é‡Œè¯¥å¤§ç¥çš„æ–¹æ¡ˆã€‚ é€šè¿‡è¿ç”¨æ¡†æ¶çš„Middlewareå’ŒServiceProvideræ¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚
æ–°å¢ä¸­é—´ä»¶ï¼ŒLUMEN/app/Http/Middleware/CorsMiddleware.php
namespace App\Http\Middleware; use Closure; class CorsMiddleware { /** * Handle an incoming request. * * @param \Illuminate\Http\Request $request * @param \Closure $next * @return mixed */ public function handle($request, Closure $next) { $response = $next($request); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Methods&amp;#39;, &amp;#39;HEAD, GET, POST, PUT, PATCH, DELETE&amp;#39;); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Headers&amp;#39;, $request-&amp;gt;header(&amp;#39;Access-Control-Request-Headers&amp;#39;)); $response-&amp;gt;header(&amp;#39;Access-Control-Allow-Origin&amp;#39;, &amp;#39;*&amp;#39;); return $response; } } å®šä¹‰ServiceProviderï¼ŒLUMEN/app/Providers/CatchAllOptionsRequestsProvider.php
namespace App\Providers; use Illuminate\Support\ServiceProvider; /** * If the incoming request is an OPTIONS request * we will register a handler for the requested route */ class CatchAllOptionsRequestsProvider extends ServiceProvider { public function register() { $request = app(&amp;#39;request&amp;#39;); if ($request-&amp;gt;isMethod(&amp;#39;OPTIONS&amp;#39;)) { app()-&amp;gt;options($request-&amp;gt;path(), function() { return response(&amp;#39;&amp;#39;, 200)-&amp;gt;header(&amp;#39;Access-Control-Allow-Origin&amp;#39;, &amp;#39;*&amp;#39;); }); } } } åœ¨LUMEN/bootstrap/app.</description>
            <content type="html"><![CDATA[

<h3 id="ä½¿ç”¨lumenæ¡†æ¶å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜"><strong>ä½¿ç”¨Lumenæ¡†æ¶å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜</strong></h3>

<p>è·¨åŸŸé—®é¢˜æƒ³å¿…æ˜¯æ¯ä¸ªä»äº‹webç›¸å…³å¼€å‘çš„åŒå­¦ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ç°åœ¨è¶Šæ¥è¶Šå¤šçš„åº”ç”¨é‡‡ç”¨çš„å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œæ‰€ä»¥è§£å†³è·¨åŸŸé—®é¢˜æˆäº†å¤§å®¶å¿…ä¸å¯å°‘çš„ä¸€é¡¹æŠ€èƒ½ã€‚æœ€è¿‘åœ¨ä½¿ç”¨Lumenæ¡†æ¶å¼€å‘æ—¶ä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>

<p>è¿›å…¥ä¸»é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆæ¥ä¸ªé“ºå«ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Œä»¥åŠä¸€äº›è§£å†³æ–¹æ¡ˆ <a href="http://www.cnblogs.com/davidwang456/p/3977627.html" target="_blank">è¿™æ˜¯é“ºå«</a></p>

<p>æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä»”ç»†çœ‹çœ‹ï¼Œå…¶å®W3Cæ ‡å‡†çš„è§£å†³æ–¹æ¡ˆæ˜¯åªè¦åœ¨æœåŠ¡å™¨responseçš„å¤´éƒ¨å¸¦ä¸Š<code>Access-Control-Allow-Originï¼šDOMAIN</code>(å…è®¸è·¨åŸŸè®¿é—®çš„åŸŸåï¼Œ<code>*</code>ä»£è¡¨æ‰€æœ‰)ï¼Œä¸è¿‡éœ€è¦ä¸€æçš„æ˜¯è¯¥æ–¹æ¡ˆåªæ”¯æŒIE8åŠä»¥ä¸Šï¼Œä»¥åŠä¸€äº›ç°ä»£æµè§ˆå™¨(Fire Fox,Chrome,etc.)ã€‚è§£å†³è·¨åŸŸæ¯”è¾ƒå¸¸è§çš„è¿˜æœ‰ä½¿ç”¨jsonpï¼Œä½†è¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸å…·ä½“å±•å¼€äº†ã€‚</p>

<p>å¥½äº†ï¼Œä¸Šé¢å•°å—¦äº†é‚£ä¹ˆå¤šï¼Œä¸‹é¢è¿›å…¥ä¸»é¢˜ï¼Œé‚£ä¹ˆåœ¨Lumenæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆè§£å†³è·¨åŸŸé—®é¢˜å‘¢?
è¿™è¾¹ä¸»è¦å‚è€ƒäº†<a href="https://gist.github.com/danharper/06d2386f0b826b669552" target="_blank">è¿™é‡Œ</a>è¯¥å¤§ç¥çš„æ–¹æ¡ˆã€‚
é€šè¿‡è¿ç”¨æ¡†æ¶çš„Middlewareå’ŒServiceProvideræ¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚</p>

<p>æ–°å¢ä¸­é—´ä»¶ï¼Œ<code>LUMEN/app/Http/Middleware/CorsMiddleware.php</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">namespace App\Http\Middleware;

use Closure;

class CorsMiddleware
{
    /**
     * Handle an incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    public function handle($request, Closure $next)
    {
        $response = $next($request);

        $response-&gt;header(&#39;Access-Control-Allow-Methods&#39;, &#39;HEAD, GET, POST, PUT, PATCH, DELETE&#39;);
        $response-&gt;header(&#39;Access-Control-Allow-Headers&#39;, $request-&gt;header(&#39;Access-Control-Request-Headers&#39;));
        $response-&gt;header(&#39;Access-Control-Allow-Origin&#39;, &#39;*&#39;);

        return $response;
    }
}</code></pre></div>
<p>å®šä¹‰ServiceProviderï¼Œ<code>LUMEN/app/Providers/CatchAllOptionsRequestsProvider.php</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">namespace App\Providers;

use Illuminate\Support\ServiceProvider;

/**
 * If the incoming request is an OPTIONS request
 * we will register a handler for the requested route
 */
class CatchAllOptionsRequestsProvider extends ServiceProvider
{
	public function register()
	{
	    $request = app(&#39;request&#39;);

	    if ($request-&gt;isMethod(&#39;OPTIONS&#39;))
	    {
	    	app()-&gt;options($request-&gt;path(), function() {
	    		return response(&#39;&#39;, 200)-&gt;header(&#39;Access-Control-Allow-Origin&#39;, &#39;*&#39;);
	    	});
	    }
  	}
}</code></pre></div>
<p>åœ¨<code>LUMEN/bootstrap/app.php</code>ä¸­åŠ è½½å¯¹åº”çš„ä¸­é—´ä»¶ï¼Œæ³¨å†ŒServiceProviderã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$app-&gt;routeMiddleware([
    &#39;cors&#39; =&gt; App\Http\Middleware\CorsMiddleware::class,
]);
...
$app-&gt;register(App\Providers\CatchAllOptionsRequestsProvider::class);</code></pre></div>
<p>çœ‹åˆ°è¿™é‡Œï¼Œé—®é¢˜æ˜¯å·²ç»è§£å†³äº†ã€‚ä½†æœ‰ä¸€ä¸ªé—®é¢˜æˆ‘å¼€å§‹ä¸€ç›´æƒ³ä¸æ˜ç™½ï¼ŒCatchAllOptionsRequestsProviderå­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦å•ç‹¬å¤„ç†OPTIONSçš„è¯·æ±‚ï¼Ÿä¸æ˜¯ä¸€ä¸ªä¸­é—´ä»¶å°±å¯ä»¥å…¨éƒ¨å¤„ç†äº†å—ï¼Ÿ
githubä¸Šä¹Ÿæœ‰äººè·Ÿæˆ‘æœ‰åŒæ ·çš„ç–‘é—®

    <img src="/assets/images/lumen-cors-1.jpg"  data-action="zoom" alt="lumen-bootstrap-app"  class="center"  />
</p>

<p>ç›´åˆ°å‰æ®µæ—¶é—´å†å»çœ‹æ—¶æ‰çœ‹åˆ°ä¸‹é¢è¿™ä½å¤§ç¥çš„è¯„è®º

    <img src="/assets/images/lumen-cors-2.jpg"  data-action="zoom" alt="lumen-bootstrap-app"  class="center"  />
</p>

<p>åœ¨ç»“åˆä¸Šé¢çš„é“ºå«ï¼ŒåŸæ¥</p>

<blockquote>
<p>CORS (Cross-Origin Resource Sharing)ï¼ŒW3Cåˆ¶å®šçš„è·¨ç«™èµ„æºåˆ†äº«æ ‡å‡†ã€‚postå‰ä¼šäº§ç”Ÿä¸€æ¬¡optionså—…æ¢ï¼ˆç§°ä¹‹ä¸ºpreflightï¼Œä½†ç®€å•è¯·æ±‚ä¸ä¼šå‡ºç°ï¼‰æ¥ç¡®è®¤æœ‰å¦è·¨åŸŸè¯·æ±‚çš„æƒé™ã€‚</p>
</blockquote>

<p>ç”±äºåœ¨Lumençš„è·¯ç”±é‡Œå¹¶æœªå®šä¹‰å¯¹åº”çš„optionsè¯·æ±‚ï¼Œæ‰€ä»¥æ¡†æ¶ç›´æ¥è¿”å›405äº†ã€‚è¯·æ±‚å¹¶ä¸ä¼šè¢«åˆ†å‘ï¼Œæ‰€ä»¥ä¸ä¼šè¢«ä¸­é—´ä»¶å¤„ç†ã€‚å› æ­¤æ‰éœ€è¦ç”¨<code>CatchAllOptionsRequestsProvider.php</code>æ¥è·å–è¯·æ±‚ï¼Œå¹¶å¯¹optionsçš„è¯·æ±‚å•ç‹¬å¤„ç†ã€‚</p>

<hr />

<p><strong>å‚è€ƒ</strong></p>

<ul>
<li><a href="http://www.cnblogs.com/davidwang456/p/3977627.html" target="_blank">http://www.cnblogs.com/davidwang456/p/3977627.html</a></li>
<li><a href="https://gist.github.com/danharper/06d2386f0b826b669552" target="_blank">https://gist.github.com/danharper/06d2386f0b826b669552</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>php5.6 curl ä¸Šä¼ æ–‡ä»¶å¤±è´¥</title>
            <link>/posts/2016/04/05/php-curlfile/</link>
            <pubDate>Tue, 05 Apr 2016 00:00:00 +0000</pubDate>
            
            <guid>/posts/2016/04/05/php-curlfile/</guid>
            <description>php5.6 CURLFile æ–°é¡¹ç›®ä¸­è¦å®Œæˆä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„æ¥å£ï¼Œè¦å†™ä¸ªè‡ªæµ‹æ¥å£æ—¶é‡åˆ°çš„å‘ã€‚ã€‚ã€‚
ä¹‹å‰php5.4ç‰ˆæœ¬æ—¶curlä¸­ç›´æ¥é€šè¿‡@ç¬¦å·+æ–‡ä»¶è·¯å¾„ï¼Œåˆ™curlè‡ªåŠ¨ä¼šæŠŠæ–‡ä»¶è§£æä¸Šä¼ ï¼Œåç«¯é€šè¿‡$_FILESå˜é‡æ‹¿åˆ°ï¼Œä½†åœ¨å†™è‡ªæµ‹è„šæœ¬æ—¶æ­»æ´»æ²¡ååº”ã€‚ã€‚ã€‚çº ç»“äº†åŠå¤©æ‰åœ¨ stackoverflow æ‰¾åˆ°ç­”æ¡ˆã€‚
åŸæ¥æ–°ç‰ˆphpä¸­CURLOPT_SAFE_UPLOADå‚æ•°é»˜è®¤å·²ç»æ˜¯trueäº†ï¼Œæ‰€ä»¥ä¸æ”¯æŒ@è¿™æ ·ï¼ˆä¸å®‰å…¨ï¼‰çš„å†™æ³•ï¼Œè€Œæ˜¯é€šè¿‡CURLFileç±»æ¥å®Œæˆæ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ ã€‚ä»£ç å¦‚ä¸‹:
if ((version_compare(PHP_VERSION, &amp;#39;5.5&amp;#39;) &amp;gt;= 0)) { $aPost[&amp;#39;file&amp;#39;] = new CURLFile($localFile); curl_setopt($ch, CURLOPT_SAFE_UPLOAD, true); } else { $aPost[&amp;#39;file&amp;#39;] = &amp;#34;@&amp;#34;.$localFile; } $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $apiurl); curl_setopt($ch, CURLOPT_TIMEOUT, 120); curl_setopt($ch, CURLOPT_BUFFERSIZE, 128); curl_setopt($ch, CURLOPT_POSTFIELDS, $aPost); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $sResponse = curl_exec ($ch); å½“ç„¶äº†ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨CURLFileæ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ‰‹åŠ¨è®¾ç½®CURLOPT_SAFE_UPLOADä¸ºfalseåï¼Œ@+æ–‡ä»¶åˆèƒ½æ”¯æŒäº†ï¼ˆä¸€èˆ¬phpç‰ˆæœ¬å‡çº§å…¼å®¹å¤„ç†é‡‡ç”¨æ­¤æ–¹å¼æ”¹åŠ¨æˆæœ¬è¾ƒå°ï¼‰</description>
            <content type="html"><![CDATA[

<h3 id="php5-6-curlfile">php5.6 CURLFile</h3>

<p>æ–°é¡¹ç›®ä¸­è¦å®Œæˆä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„æ¥å£ï¼Œè¦å†™ä¸ªè‡ªæµ‹æ¥å£æ—¶é‡åˆ°çš„å‘ã€‚ã€‚ã€‚</p>

<p>ä¹‹å‰php5.4ç‰ˆæœ¬æ—¶curlä¸­ç›´æ¥é€šè¿‡@ç¬¦å·+æ–‡ä»¶è·¯å¾„ï¼Œåˆ™curlè‡ªåŠ¨ä¼šæŠŠæ–‡ä»¶è§£æä¸Šä¼ ï¼Œåç«¯é€šè¿‡$_FILESå˜é‡æ‹¿åˆ°ï¼Œä½†åœ¨å†™è‡ªæµ‹è„šæœ¬æ—¶æ­»æ´»æ²¡ååº”ã€‚ã€‚ã€‚çº ç»“äº†åŠå¤©æ‰åœ¨ <a href="http://stackoverflow.com/questions/25934128/curl-file-uploads-not-working-anymore-after-upgrade-from-php-5-5-to-5-6" target="_blank">stackoverflow</a> æ‰¾åˆ°ç­”æ¡ˆã€‚</p>

<p>åŸæ¥æ–°ç‰ˆphpä¸­<code>CURLOPT_SAFE_UPLOAD</code>å‚æ•°é»˜è®¤å·²ç»æ˜¯trueäº†ï¼Œæ‰€ä»¥ä¸æ”¯æŒ@è¿™æ ·ï¼ˆä¸å®‰å…¨ï¼‰çš„å†™æ³•ï¼Œè€Œæ˜¯é€šè¿‡CURLFileç±»æ¥å®Œæˆæ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ ã€‚ä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">if ((version_compare(PHP_VERSION, &#39;5.5&#39;) &gt;= 0)) {
    $aPost[&#39;file&#39;] = new CURLFile($localFile);
    curl_setopt($ch, CURLOPT_SAFE_UPLOAD, true);
} else {
    $aPost[&#39;file&#39;] = &#34;@&#34;.$localFile;
}

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $apiurl);
curl_setopt($ch, CURLOPT_TIMEOUT, 120);
curl_setopt($ch, CURLOPT_BUFFERSIZE, 128);
curl_setopt($ch, CURLOPT_POSTFIELDS, $aPost);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$sResponse = curl_exec ($ch);</code></pre></div>
<p>å½“ç„¶äº†ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨CURLFileæ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ‰‹åŠ¨è®¾ç½®<code>CURLOPT_SAFE_UPLOAD</code>ä¸ºfalseåï¼Œ@+æ–‡ä»¶åˆèƒ½æ”¯æŒäº†ï¼ˆä¸€èˆ¬phpç‰ˆæœ¬å‡çº§å…¼å®¹å¤„ç†é‡‡ç”¨æ­¤æ–¹å¼æ”¹åŠ¨æˆæœ¬è¾ƒå°ï¼‰</p>
]]></content>
        </item>
        
        <item>
            <title>Swaggeråˆæ¢</title>
            <link>/posts/2015/12/25/swagger/</link>
            <pubDate>Fri, 25 Dec 2015 00:00:00 +0000</pubDate>
            
            <guid>/posts/2015/12/25/swagger/</guid>
            <description>ç¼˜ç”± æœ€è¿‘é¡¹ç›®è¦åŠ æ–°åŠŸèƒ½ï¼Œå›å¤´çœ‹äº†ä¸‹ä¹‹å‰å®šä¹‰çš„æ¥å£æ–‡æ¡£ï¼Œç®€ç›´ä¸å¿ç›´è§†ã€‚æœ‰ç”¨txtçš„ã€æœ‰ç”¨wordçš„ï¼Œå„ç§æ ¼å¼ä¸è§„èŒƒï¼Œå†™æ³•ä¹Ÿä¸ä¸€æ ·ï¼Œçœ‹èµ·æ¥å¾ˆå¤´ç–¼ã€‚ä¸å¤Ÿç›´è§‚ï¼Œå¹¶ä¸”ä¹Ÿå¾ˆéš¾ç»´æŠ¤ã€‚æƒ³èµ·ä¹‹å‰åŒäº‹åˆ†äº«è¿‡çš„Swaggerï¼Œè¶ç€æœ€è¿‘ä¸å¿™ï¼Œå°±å†³å®šç€æ‰‹æŠŠä¹‹å‰çš„APIæ–‡æ¡£æ•´ç†åˆ°Swaggerä¸­å»ã€‚
Swaggeræ˜¯ä»€ä¹ˆ  å®˜æ–¹çš„ä»‹ç»æ˜¯ A POWERFUL INTERFACE TO YOUR APIã€‚
 é€šè¿‡Swaggeræä¾›çš„ç›¸å…³toolså¯ä»¥å¾ˆç›´è§‚çš„åœ¨ç½‘é¡µä¸Šæµè§ˆä½ çš„APIã€æµ‹è¯•APIã€ç”šè‡³é€šè¿‡è§£æSwagger definitionsï¼ˆä¸€ä¸ªYAML or JSONæ ¼å¼çš„æ–‡æ¡£ï¼‰ï¼Œç›´æ¥è‡ªåŠ¨ç”Ÿæˆç›¸å…³ä»£ç ï¼ˆswagger-codegenï¼‰ã€‚ä¸ªäººç†è§£Swaggerçš„æ ¸å¿ƒå°±æ˜¯Swagger definitionsï¼Œç›¸å…³å·¥å…·å¯ä»¥ï¼ˆSwagger Coreã€Swagger Editorï¼‰ç”ŸæˆSwagger definitionsï¼Œï¼ˆSwagger UIã€Swagger Editorï¼‰è§£æSwagger definitionsç”ŸæˆUIç•Œé¢ã€‚
ä¸ºä»€ä¹ˆè¦ç”¨Swagger å·¥å…·ä»æ¥éƒ½æ˜¯ä¸ºäº†æé«˜æ•ˆç‡è€Œäº§ç”Ÿçš„ï¼Œæƒ³æƒ³ä»å‰å…‰å†™ä¸ªAPIæ–‡æ¡£éƒ½è¦èŠ±å¥½äº›æ—¶é—´ï¼Œè€Œä¸”å…¶ä¸­è¿˜ä¼šå‡ºç°ç†è§£ä¸Šçš„åå·®ï¼Œéœ€è¦å‰åç«¯åå¤æ²Ÿé€šç¡®è®¤ï¼Œä¸ä»…æµªè´¹äº†æ—¶é—´è¿˜æ²¡æœ‰ä»€ä¹ˆæ•ˆç‡ã€‚é€šè¿‡ä½¿ç”¨Swaggerï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ç”¨å®ƒæ¥ä½œä¸ºAPIçš„æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æµ‹è¯•APIï¼Œå‰ç«¯ or å®¢æˆ·ç«¯çš„åŒå­¦é€šè¿‡å¯¹å„ä¸ªAPIçš„ç‚¹å‡»å¯ä»¥å®æ—¶çš„çœ‹åˆ°è¿”å›ç»“æœï¼ŒèŠ‚çº¦äº†å¤§é‡çš„æ²Ÿé€šæ—¶é—´ï¼Œæå¤§çš„æé«˜äº†å¼€å‘æ•ˆç‡ã€‚
æ€ä¹ˆç”¨ Swagger Api æä¾›äº†å¦‚ä¸‹å·¥å…·æ¥ä¸ºæˆ‘ä»¬æœåŠ¡:
 Swagger Core [Java-related libraries for generating and reading Swagger definitions] ä¸€ä¸ªJAVA Libï¼Œç”¨æ¥ç”Ÿæˆå’Œè§£æSwagger definitionsï¼Œæ²¡ç”¨è¿‡ã€‚ã€‚
 Swagger Codegen [Command-line tool for generating both client and server side code from a Swagger definition] æ®è¯´å¯ä»¥é€šè¿‡å®ƒè§£æSwagger definitionsç”Ÿæˆå¯¹åº”çš„åç«¯APIå®ç°ä»£ç ï¼Œæ²¡ç”¨è¿‡ã€‚ã€‚
 Swagger UI [Browser based UI for exploring a Swagger defined API] é€šè¿‡è§£æå®šä¹‰å¥½çš„Swagger definitionsæ„å»ºå¯¹åº”çš„API UIç•Œé¢ã€‚ GitHub - Swagger UIã€‚ GitHubé‡Œçš„è¯´æ˜åŸºæœ¬éƒ½å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ã€‚åŸºæœ¬ä¸Šåªè¦ä½ é¢„å…ˆè£…å¥½npm(node)å’Œgulpï¼Œç›´æ¥ç…§ç€æ­¥éª¤å°±æ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¯¹åº”çš„demo - petstore.</description>
            <content type="html"><![CDATA[

<h4 id="ç¼˜ç”±"><strong>ç¼˜ç”±</strong></h4>

<p>æœ€è¿‘é¡¹ç›®è¦åŠ æ–°åŠŸèƒ½ï¼Œå›å¤´çœ‹äº†ä¸‹ä¹‹å‰å®šä¹‰çš„æ¥å£æ–‡æ¡£ï¼Œç®€ç›´ä¸å¿ç›´è§†ã€‚æœ‰ç”¨txtçš„ã€æœ‰ç”¨wordçš„ï¼Œå„ç§æ ¼å¼ä¸è§„èŒƒï¼Œå†™æ³•ä¹Ÿä¸ä¸€æ ·ï¼Œçœ‹èµ·æ¥å¾ˆå¤´ç–¼ã€‚ä¸å¤Ÿç›´è§‚ï¼Œå¹¶ä¸”ä¹Ÿå¾ˆéš¾ç»´æŠ¤ã€‚æƒ³èµ·ä¹‹å‰åŒäº‹åˆ†äº«è¿‡çš„Swaggerï¼Œè¶ç€æœ€è¿‘ä¸å¿™ï¼Œå°±å†³å®šç€æ‰‹æŠŠä¹‹å‰çš„APIæ–‡æ¡£æ•´ç†åˆ°Swaggerä¸­å»ã€‚</p>

<hr />

<h4 id="swaggeræ˜¯ä»€ä¹ˆ-http-swagger-io"><strong><a href="http://swagger.io" target="_blank">Swaggeræ˜¯ä»€ä¹ˆ</a></strong></h4>

<blockquote>
<p>å®˜æ–¹çš„ä»‹ç»æ˜¯ A POWERFUL INTERFACE TO YOUR APIã€‚</p>
</blockquote>

<p>é€šè¿‡Swaggeræä¾›çš„ç›¸å…³toolså¯ä»¥å¾ˆç›´è§‚çš„åœ¨ç½‘é¡µä¸Šæµè§ˆä½ çš„APIã€æµ‹è¯•APIã€ç”šè‡³é€šè¿‡è§£æSwagger definitionsï¼ˆä¸€ä¸ªYAML or JSONæ ¼å¼çš„æ–‡æ¡£ï¼‰ï¼Œç›´æ¥è‡ªåŠ¨ç”Ÿæˆç›¸å…³ä»£ç ï¼ˆswagger-codegenï¼‰ã€‚ä¸ªäººç†è§£Swaggerçš„æ ¸å¿ƒå°±æ˜¯Swagger definitionsï¼Œç›¸å…³å·¥å…·å¯ä»¥ï¼ˆSwagger Coreã€Swagger Editorï¼‰ç”ŸæˆSwagger definitionsï¼Œï¼ˆSwagger UIã€Swagger Editorï¼‰è§£æSwagger definitionsç”ŸæˆUIç•Œé¢ã€‚</p>

<hr />

<h4 id="ä¸ºä»€ä¹ˆè¦ç”¨swagger"><strong>ä¸ºä»€ä¹ˆè¦ç”¨Swagger</strong></h4>

<p>å·¥å…·ä»æ¥éƒ½æ˜¯ä¸ºäº†æé«˜æ•ˆç‡è€Œäº§ç”Ÿçš„ï¼Œæƒ³æƒ³ä»å‰å…‰å†™ä¸ªAPIæ–‡æ¡£éƒ½è¦èŠ±å¥½äº›æ—¶é—´ï¼Œè€Œä¸”å…¶ä¸­è¿˜ä¼šå‡ºç°ç†è§£ä¸Šçš„åå·®ï¼Œéœ€è¦å‰åç«¯åå¤æ²Ÿé€šç¡®è®¤ï¼Œä¸ä»…æµªè´¹äº†æ—¶é—´è¿˜æ²¡æœ‰ä»€ä¹ˆæ•ˆç‡ã€‚é€šè¿‡ä½¿ç”¨Swaggerï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ç”¨å®ƒæ¥ä½œä¸ºAPIçš„æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æµ‹è¯•APIï¼Œå‰ç«¯ or å®¢æˆ·ç«¯çš„åŒå­¦é€šè¿‡å¯¹å„ä¸ªAPIçš„ç‚¹å‡»å¯ä»¥å®æ—¶çš„çœ‹åˆ°è¿”å›ç»“æœï¼ŒèŠ‚çº¦äº†å¤§é‡çš„æ²Ÿé€šæ—¶é—´ï¼Œæå¤§çš„æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p>

<hr />

<h4 id="æ€ä¹ˆç”¨"><strong>æ€ä¹ˆç”¨</strong></h4>

<p><a href="https://github.com/swagger-api" target="_blank">Swagger Api</a> æä¾›äº†å¦‚ä¸‹å·¥å…·æ¥ä¸ºæˆ‘ä»¬æœåŠ¡:</p>

<ul>
<li><p><em>Swagger Core</em> [Java-related libraries for generating and reading Swagger definitions]
ä¸€ä¸ªJAVA Libï¼Œç”¨æ¥ç”Ÿæˆå’Œè§£æSwagger definitionsï¼Œæ²¡ç”¨è¿‡ã€‚ã€‚</p></li>

<li><p><em>Swagger Codegen</em> [Command-line tool for generating both client and server side code from a Swagger definition]
æ®è¯´å¯ä»¥é€šè¿‡å®ƒè§£æSwagger definitionsç”Ÿæˆå¯¹åº”çš„åç«¯APIå®ç°ä»£ç ï¼Œæ²¡ç”¨è¿‡ã€‚ã€‚</p></li>

<li><p><em>Swagger UI</em> [Browser based UI for exploring a Swagger defined API]
é€šè¿‡è§£æå®šä¹‰å¥½çš„Swagger definitionsæ„å»ºå¯¹åº”çš„API UIç•Œé¢ã€‚
<a href="https://github.com/swagger-api/swagger-ui" target="_blank">GitHub - Swagger UI</a>ã€‚
GitHubé‡Œçš„è¯´æ˜åŸºæœ¬éƒ½å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ã€‚åŸºæœ¬ä¸Šåªè¦ä½ é¢„å…ˆè£…å¥½npm(node)å’Œgulpï¼Œç›´æ¥ç…§ç€æ­¥éª¤å°±æ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¯¹åº”çš„demo - <a href="http://petstore.swagger.io/" target="_blank">petstore.swagger.io</a>ï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹è§æ„å»ºå¥½çš„åº”ç”¨çš„æ ·å­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è§£æè‡ªå·±å®šä¹‰çš„Swagger definitionsæ¥æŸ¥çœ‹è‡ªå·±å®šä¹‰çš„APIï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šé‡åˆ°è·¨åŸŸçš„é—®é¢˜ï¼Œè¿™é‡Œä¸ªäººå»ºè®®æ˜¯æŠŠSwagger UIæ„å»ºåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥é¿å…äº†ã€‚æœ€åä¸Šå¼ å®Œæˆå›¾ã€‚

    <img src="/assets/images/swagger-ui-example.jpg"  data-action="zoom" alt="swagger-ui-example"  class="center"  />
</p></li>

<li><p><em>Swagger Editor</em> [Browser based editor for authoring Swagger definitions in YAML or JSON format]
ä¸Šé¢å¾ˆå¤šåœ°æ–¹éƒ½æåˆ°äº†Swagger definitionsï¼Œé‚£ç©¶ç«ŸSwagger definitionsè¦å¦‚ä½•å®šä¹‰å‘¢ã€‚Swagger Editoræä¾›äº†webç•Œé¢æ¥å¸®æˆ‘ä»¬ç¼–è¾‘ã€ç”Ÿæˆï¼ˆå¯¼å‡ºï¼‰å¯¹åº”çš„Swagger definitionsï¼ŒåŒæ—¶Swagger Editorä¹Ÿå¯ä»¥å®æ—¶çš„è§£æç¼–è¾‘å¥½çš„Swagger definitionsï¼Œç”Ÿæˆå¯¹åº”çš„UIç•Œé¢ï¼ˆç±»ä¼¼Swagger UIï¼‰ï¼Œä¸ä»…å¦‚æ­¤Swagger Editorè¿˜æ”¯æŒç”Ÿæˆå¯¹åº”client codeï¼ˆæ€»ä¹‹æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å·¥å…·ï¼ŒåŸºæœ¬ä¸Šç”¨å®ƒå°±èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†ï¼‰</p>

<p>åŒæ ·çš„å¯¹åº”çš„<a href="https://github.com/swagger-api/swagger-editor" target="_blank">GitHub - Swagger Editor</a>ï¼Œå®‰è£…æ–¹å¼å¤§åŒå°å¼‚ï¼Œçº¿ä¸Šdemo - <a href="http://editor.swagger.io/" target="_blank">editor.swagger.io</a>ï¼ŒåŒæ ·çš„ä¹Ÿä¼šæœ‰è·¨åŸŸçš„é—®é¢˜ã€‚</p>

<h2 id="hahahugoshortcode-s1-hbhb">
    <img src="/assets/images/swagger-editor-example.jpg"  data-action="zoom" alt="swagger-editor-example"  class="center"  />
</h2></li>
</ul>

<h4 id="å†™åœ¨æœ€å"><strong>å†™åœ¨æœ€å</strong></h4>

<p>å…³äºå…·ä½“çš„Swagger definitionså¦‚ä½•å®šä¹‰å°±å¾—å‚ç…§å®˜æ–¹æ–‡æ¡£äº†ï¼Œæˆ‘åªç”¨è¿‡ä¸€ä¸ªenumå‚æ•°ï¼Œå®ç°äº†è¯·æ±‚å‚æ•°çš„selecté€‰é¡¹ã€‚æœ€ååæ§½ä¸‹ï¼Œå…³äºSwaggerçš„åŸºæœ¬ä¸Šéƒ½æ˜¯è‹±æ–‡æ–‡æ¡£ï¼Œä¸­æ–‡èµ„æ–™è¾ƒå°‘ï¼Œå¯¼è‡´æœ€ååœ¨å®ç°è‡ªå·±éœ€æ±‚æ—¶èŠ±è´¹äº†ä¸å°‘æ—¶é—´ï¼Œå®é™…ä¸Šä»…ä»…æ˜¯é…ä¸€ä¸ªå‚æ•°å°±å¥½äº†T Tã€‚</p>
]]></content>
        </item>
        
        <item>
            <title>MongoDBä½¿ç”¨å¿ƒå¾—</title>
            <link>/posts/2015/12/08/mongodb/</link>
            <pubDate>Tue, 08 Dec 2015 00:00:00 +0000</pubDate>
            
            <guid>/posts/2015/12/08/mongodb/</guid>
            <description>é¦–å…ˆMongoDBæ˜¯ä»€ä¹ˆ åŒºåˆ«äºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼ˆMySQLï¼‰ï¼ŒMongoDBæ˜¯NoSQLç±»å‹çš„æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼ã€æ–‡ä»¶ã€‘å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿã€‚MongoDBå°†æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ•°æ®ç»“æ„ç”±é”®å€¼(key=&amp;gt;value)å¯¹ç»„æˆã€‚MongoDBæ–‡æ¡£ç±»ä¼¼äº JSONï¼ˆBSONï¼‰å¯¹è±¡ã€‚å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„åŠæ–‡æ¡£æ•°ç»„ã€‚æ‰€æœ‰çš„æ•°æ®å¯¹äºMongoDBæ¥è¯´éƒ½æ˜¯æ–‡æ¡£ï¼Œä¸å­˜åœ¨ä¼ ç»Ÿå…³ç³»å‹æ•°æ®çš„å­—æ®µé™åˆ¶ï¼Œè¿™å°±æ„å‘³è¿™ä½ åŒä¸€ä¸ªdocumentä¸­çš„æ¯æ¡æ•°æ®å¯èƒ½å­—æ®µéƒ½ä¼šä¸ä¸€æ ·ï¼Œéå¸¸çµæ´»ï¼ˆç»´æŠ¤å›°éš¾ï¼‰ã€‚
MongoDBçš„ç‰¹ç‚¹  é¢å‘æ–‡ä»¶çš„ é«˜æ€§èƒ½ é«˜å¯ç”¨æ€§ æ˜“æ‰©å±•æ€§ ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€  æˆ‘ä»¬èƒ½ç”¨MongoDBåšä»€ä¹ˆ ç”±äºMongoDBä¸æ”¯æŒäº‹åŠ¡ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡ï¼ˆå¦‚é“¶è¡Œä¸šåŠ¡ï¼Œåº”ç”¨æ ¸å¿ƒä¸šåŠ¡ç­‰ï¼‰å¹¶ä¸é€‚ç”¨ã€‚å¯¹äºå…¶ä»–ä¸ªäººç½‘ç«™ï¼ˆæ•°æ®ç±»å‹ç®€å•ï¼‰ï¼Œæ—¥å¿—åˆ†æç±»å‹ä¸šåŠ¡ï¼ˆå†™å…¥é‡å¤§ï¼‰ç­‰éƒ½å’Œé€‚åˆï¼Œç”šè‡³ä¹Ÿå¯ä»¥æŠŠä»–å½“åšç¼“å­˜ä½¿ç”¨ã€‚
æ€ä¹ˆç”¨ è¦ç”¨å¥½MongoDBï¼Œé¦–å…ˆä½ åº”è¯¥å¿˜è®°ä½ å­¦è¿‡çš„é‚£äº›ä¼˜é›…æ— æ•Œçš„SQLï¼Œå¿˜è®°ä¼ ç»Ÿçš„èŒƒå¼åŒ–è®¾è®¡ã€‚ ä¸¾ä¸ªæ —å­ï¼š ä¸€ä¸ªä¸šåŠ¡åœºæ™¯æ˜¯ï¼Œä¿å­˜å›¾ä¹¦é¦†å†…çš„æ‰€æœ‰ä¹¦å’Œå…¶ä½œè€…çš„ç›¸å…³ä¿¡æ¯ã€‚ åœ¨ä½¿ç”¨ä¼ ç»Ÿçš„èŒƒå¼åŒ–å…³ç³»å‹æ•°æ®è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰1å¼ bookè¡¨å’Œ1å¼ authorè¡¨
#book: { &amp;#34;_id&amp;#34; : ObjectId(&amp;#34;5124b5d86041c7dca81917&amp;#34;), &amp;#34;title&amp;#34; : &amp;#34;å¦‚ä½•ä½¿ç”¨MongoDB&amp;#34;, &amp;#34;author&amp;#34; : [ ObjectId(&amp;#34;144b5d83041c7dca84416&amp;#34;), ObjectId(&amp;#34;144b5d83041c7dca84418&amp;#34;), ] } #author: { [ &amp;#34;_id&amp;#34; : ObjectId(&amp;#34;144b5d83041c7dca84416&amp;#34;), &amp;#34;name&amp;#34; : &amp;#34;å¼ ä¸‰&amp;#34;, &amp;#34;age&amp;#34; : &amp;#34;30&amp;#34;, &amp;#34;sex&amp;#34; : &amp;#34;male&amp;#34; ], [ &amp;#34;_id&amp;#34; : ObjectId(&amp;#34;144b5d83041c7dca84418&amp;#34;), &amp;#34;name&amp;#34; : &amp;#34;æå››&amp;#34;, &amp;#34;age&amp;#34; : &amp;#34;28&amp;#34;, &amp;#34;sex&amp;#34; : &amp;#34;female&amp;#34; ], ... } è¿™ç§è®¾è®¡çš„åå¤„æ˜¯ï¼ŒæŸ¥è¯¢æ—¶è¦joinæ•ˆç‡ä¼šæ¯”è¾ƒå·®
å¦‚æœæ˜¯é‡‡ç”¨MongoDBæ¥å¤„ç†ï¼Œå®Œå…¨å¯ä»¥è¿™æ ·ï¼š
{ &amp;#34;_id&amp;#34; : ObjectId(&amp;#34;5124b5d86041c7dca81917&amp;#34;), &amp;#34;title&amp;#34; : &amp;#34;å¦‚ä½•ä½¿ç”¨MongoDB&amp;#34;, &amp;#34;author&amp;#34; : [ { &amp;#34;name&amp;#34; : &amp;#34;å¼ ä¸‰&amp;#34;, &amp;#34;age&amp;#34; : &amp;#34;30&amp;#34;, &amp;#34;sex&amp;#34; : &amp;#34;male&amp;#34; }, { &amp;#34;name&amp;#34; : &amp;#34;æå››&amp;#34;, &amp;#34;age&amp;#34; : &amp;#34;28&amp;#34;, &amp;#34;sex&amp;#34; : &amp;#34;female&amp;#34; }, ] } è¿™æ ·é€šè¿‡è¿™ä¸€ä¸ªdocumentå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚å½“ç„¶ï¼Œä»»ä½•äº‹ç‰©éƒ½æ˜¯æœ‰ä¸¤é¢æ€§çš„ï¼Œå¦‚æœé‡åˆ°è¦æ›´æ–°authorä¿¡æ¯æ—¶ï¼Œå°±è¦æ‰¹é‡æ›´æ–°æ‰€æœ‰documentå¯¹åº”çš„ä¿¡æ¯äº†ï¼Œå‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œä¸è¦ç›²ç›®ä½¿ç”¨MongoDBï¼Œè¦é’ˆå¯¹è‡ªå·±æ‰€å¤„çš„ä¸šåŠ¡ç±»å‹æ¥é€‰æ‹©ã€‚</description>
            <content type="html"><![CDATA[

<h4 id="é¦–å…ˆmongodbæ˜¯ä»€ä¹ˆ"><strong>é¦–å…ˆMongoDBæ˜¯ä»€ä¹ˆ</strong></h4>

<p>åŒºåˆ«äºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼ˆMySQLï¼‰ï¼ŒMongoDBæ˜¯NoSQLç±»å‹çš„æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼ã€æ–‡ä»¶ã€‘å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿã€‚MongoDBå°†æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ•°æ®ç»“æ„ç”±é”®å€¼(key=&gt;value)å¯¹ç»„æˆã€‚MongoDBæ–‡æ¡£ç±»ä¼¼äº JSONï¼ˆBSONï¼‰å¯¹è±¡ã€‚å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„åŠæ–‡æ¡£æ•°ç»„ã€‚æ‰€æœ‰çš„æ•°æ®å¯¹äºMongoDBæ¥è¯´éƒ½æ˜¯æ–‡æ¡£ï¼Œä¸å­˜åœ¨ä¼ ç»Ÿå…³ç³»å‹æ•°æ®çš„å­—æ®µé™åˆ¶ï¼Œè¿™å°±æ„å‘³è¿™ä½ åŒä¸€ä¸ªdocumentä¸­çš„æ¯æ¡æ•°æ®å¯èƒ½å­—æ®µéƒ½ä¼šä¸ä¸€æ ·ï¼Œéå¸¸çµæ´»ï¼ˆç»´æŠ¤å›°éš¾ï¼‰ã€‚</p>

<hr />

<h4 id="mongodbçš„ç‰¹ç‚¹"><strong>MongoDBçš„ç‰¹ç‚¹</strong></h4>

<ul>
<li>é¢å‘æ–‡ä»¶çš„</li>
<li>é«˜æ€§èƒ½</li>
<li>é«˜å¯ç”¨æ€§</li>
<li>æ˜“æ‰©å±•æ€§</li>
<li>ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€</li>
</ul>

<hr />

<h4 id="æˆ‘ä»¬èƒ½ç”¨mongodbåšä»€ä¹ˆ"><strong>æˆ‘ä»¬èƒ½ç”¨MongoDBåšä»€ä¹ˆ</strong></h4>

<p>ç”±äºMongoDBä¸æ”¯æŒäº‹åŠ¡ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„ä¸šåŠ¡ï¼ˆå¦‚é“¶è¡Œä¸šåŠ¡ï¼Œåº”ç”¨æ ¸å¿ƒä¸šåŠ¡ç­‰ï¼‰å¹¶ä¸é€‚ç”¨ã€‚å¯¹äºå…¶ä»–ä¸ªäººç½‘ç«™ï¼ˆæ•°æ®ç±»å‹ç®€å•ï¼‰ï¼Œæ—¥å¿—åˆ†æç±»å‹ä¸šåŠ¡ï¼ˆå†™å…¥é‡å¤§ï¼‰ç­‰éƒ½å’Œé€‚åˆï¼Œç”šè‡³ä¹Ÿå¯ä»¥æŠŠä»–å½“åšç¼“å­˜ä½¿ç”¨ã€‚</p>

<hr />

<h4 id="æ€ä¹ˆç”¨"><strong>æ€ä¹ˆç”¨</strong></h4>

<p>è¦ç”¨å¥½MongoDBï¼Œé¦–å…ˆä½ åº”è¯¥å¿˜è®°ä½ å­¦è¿‡çš„é‚£äº›ä¼˜é›…æ— æ•Œçš„SQLï¼Œå¿˜è®°ä¼ ç»Ÿçš„èŒƒå¼åŒ–è®¾è®¡ã€‚
ä¸¾ä¸ªæ —å­ï¼š
ä¸€ä¸ªä¸šåŠ¡åœºæ™¯æ˜¯ï¼Œä¿å­˜å›¾ä¹¦é¦†å†…çš„æ‰€æœ‰ä¹¦å’Œå…¶ä½œè€…çš„ç›¸å…³ä¿¡æ¯ã€‚
åœ¨ä½¿ç”¨ä¼ ç»Ÿçš„èŒƒå¼åŒ–å…³ç³»å‹æ•°æ®è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰1å¼ bookè¡¨å’Œ1å¼ authorè¡¨</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#book:</span>
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;_id&#34;</span> : ObjectId<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;5124b5d86041c7dca81917&#34;</span><span style="color:#f92672">)</span>,
    <span style="color:#e6db74">&#34;title&#34;</span> : <span style="color:#e6db74">&#34;å¦‚ä½•ä½¿ç”¨MongoDB&#34;</span>,
    <span style="color:#e6db74">&#34;author&#34;</span> : <span style="color:#f92672">[</span>
        ObjectId<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;144b5d83041c7dca84416&#34;</span><span style="color:#f92672">)</span>,
        ObjectId<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;144b5d83041c7dca84418&#34;</span><span style="color:#f92672">)</span>,
    <span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">#author:</span>
<span style="color:#f92672">{</span>
    <span style="color:#f92672">[</span>
        <span style="color:#e6db74">&#34;_id&#34;</span> : ObjectId<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;144b5d83041c7dca84416&#34;</span><span style="color:#f92672">)</span>,
        <span style="color:#e6db74">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;å¼ ä¸‰&#34;</span>,
        <span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#e6db74">&#34;30&#34;</span>,
        <span style="color:#e6db74">&#34;sex&#34;</span> : <span style="color:#e6db74">&#34;male&#34;</span>
    <span style="color:#f92672">]</span>,
    <span style="color:#f92672">[</span>
        <span style="color:#e6db74">&#34;_id&#34;</span> : ObjectId<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;144b5d83041c7dca84418&#34;</span><span style="color:#f92672">)</span>,
        <span style="color:#e6db74">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;æå››&#34;</span>,
        <span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#e6db74">&#34;28&#34;</span>,
        <span style="color:#e6db74">&#34;sex&#34;</span> : <span style="color:#e6db74">&#34;female&#34;</span>
    <span style="color:#f92672">]</span>,
    ...
<span style="color:#f92672">}</span></code></pre></div>
<p>è¿™ç§è®¾è®¡çš„åå¤„æ˜¯ï¼ŒæŸ¥è¯¢æ—¶è¦joinæ•ˆç‡ä¼šæ¯”è¾ƒå·®</p>

<p>å¦‚æœæ˜¯é‡‡ç”¨MongoDBæ¥å¤„ç†ï¼Œå®Œå…¨å¯ä»¥è¿™æ ·ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;_id&#34;</span> : ObjectId<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;5124b5d86041c7dca81917&#34;</span><span style="color:#f92672">)</span>,
    <span style="color:#e6db74">&#34;title&#34;</span> : <span style="color:#e6db74">&#34;å¦‚ä½•ä½¿ç”¨MongoDB&#34;</span>,
    <span style="color:#e6db74">&#34;author&#34;</span> : <span style="color:#f92672">[</span>
        <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;å¼ ä¸‰&#34;</span>,
            <span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#e6db74">&#34;30&#34;</span>,
            <span style="color:#e6db74">&#34;sex&#34;</span> : <span style="color:#e6db74">&#34;male&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;æå››&#34;</span>,
            <span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#e6db74">&#34;28&#34;</span>,
            <span style="color:#e6db74">&#34;sex&#34;</span> : <span style="color:#e6db74">&#34;female&#34;</span>
        <span style="color:#f92672">}</span>,
    <span style="color:#f92672">]</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>è¿™æ ·é€šè¿‡è¿™ä¸€ä¸ªdocumentå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚å½“ç„¶ï¼Œä»»ä½•äº‹ç‰©éƒ½æ˜¯æœ‰ä¸¤é¢æ€§çš„ï¼Œå¦‚æœé‡åˆ°è¦æ›´æ–°authorä¿¡æ¯æ—¶ï¼Œå°±è¦æ‰¹é‡æ›´æ–°æ‰€æœ‰documentå¯¹åº”çš„ä¿¡æ¯äº†ï¼Œå‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œä¸è¦ç›²ç›®ä½¿ç”¨MongoDBï¼Œè¦é’ˆå¯¹è‡ªå·±æ‰€å¤„çš„ä¸šåŠ¡ç±»å‹æ¥é€‰æ‹©ã€‚</p>
]]></content>
        </item>
        
        <item>
            <title>Redis::OPT_SERIALIZER</title>
            <link>/posts/2015/10/20/redis-option/</link>
            <pubDate>Tue, 20 Oct 2015 00:00:00 +0000</pubDate>
            
            <guid>/posts/2015/10/20/redis-option/</guid>
            <description>æ ‡è®°ä¸€ä¸ªæœ€è¿‘ä½¿ç”¨redisé‡åˆ°çš„å‘ èƒŒæ™¯ï¼š php-redisç‰ˆæœ¬: 2.2.1 æ–°è€é¡¹ç›®ä½¿ç”¨çš„å°è£…PHP Redisç±»ä¸ä¸€æ ·(ä¸»è¦æ˜¯ä»¥ä¸‹é€‰é¡¹)ï¼š
$redis-&amp;gt;setOption(Redis::OPT_SERIALIZER, Redis::SERIALIZER_IGBINARY); å¯¼è‡´ä½¿ç”¨è®¾ç½®è¿‡è¯¥optionçš„å°è£…çš„Redisç±»è·å–ç”±æœªè®¾ç½®è¯¥é€‰é¡¹çš„Redisç±»ç”Ÿæˆçš„keyæ—¶ç¨‹åºä¼šdownæ‰ï¼Œåä¹‹è·å–çš„keyå€¼ä¸ºä¹±ç ã€‚
è§£å†³æ–¹æ¡ˆ: æš‚æ—¶æ²¡æƒ³åˆ°æ›´å¥½çš„æ–¹æ¡ˆï¼Œç›®å‰çš„è§£å†³æ–¹å¼æ˜¯ç»Ÿä¸€redisä¸­çš„é”®å€¼ï¼Œå°†è€é¡¹ç›®ä¸­ç”¨çš„redis keyå…¨deleteæ‰ ç»Ÿä¸€ä½¿ç”¨æ–°çš„Redisç±»ç”Ÿæˆ</description>
            <content type="html"><![CDATA[

<h3 id="æ ‡è®°ä¸€ä¸ªæœ€è¿‘ä½¿ç”¨redisé‡åˆ°çš„å‘"><strong>æ ‡è®°ä¸€ä¸ªæœ€è¿‘ä½¿ç”¨redisé‡åˆ°çš„å‘</strong></h3>

<h4 id="èƒŒæ™¯"><strong>èƒŒæ™¯</strong>ï¼š</h4>

<p>php-redisç‰ˆæœ¬: <code>2.2.1</code>
æ–°è€é¡¹ç›®ä½¿ç”¨çš„å°è£…PHP Redisç±»ä¸ä¸€æ ·(ä¸»è¦æ˜¯ä»¥ä¸‹é€‰é¡¹)ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$redis-&gt;setOption(Redis::OPT_SERIALIZER, Redis::SERIALIZER_IGBINARY);</code></pre></div>
<p>å¯¼è‡´ä½¿ç”¨è®¾ç½®è¿‡è¯¥optionçš„å°è£…çš„Redisç±»è·å–ç”±æœªè®¾ç½®è¯¥é€‰é¡¹çš„Redisç±»ç”Ÿæˆçš„keyæ—¶ç¨‹åºä¼šdownæ‰ï¼Œåä¹‹è·å–çš„keyå€¼ä¸ºä¹±ç ã€‚</p>

<hr />

<h4 id="è§£å†³æ–¹æ¡ˆ"><strong>è§£å†³æ–¹æ¡ˆ</strong>:</h4>

<p>æš‚æ—¶æ²¡æƒ³åˆ°æ›´å¥½çš„æ–¹æ¡ˆï¼Œç›®å‰çš„è§£å†³æ–¹å¼æ˜¯ç»Ÿä¸€redisä¸­çš„é”®å€¼ï¼Œå°†è€é¡¹ç›®ä¸­ç”¨çš„redis keyå…¨deleteæ‰ ç»Ÿä¸€ä½¿ç”¨æ–°çš„Redisç±»ç”Ÿæˆ</p>
]]></content>
        </item>
        
        <item>
            <title>å¼€ç¯‡æ—¥å¿—</title>
            <link>/posts/2015/09/30/hello-world/</link>
            <pubDate>Wed, 30 Sep 2015 00:00:00 +0000</pubDate>
            
            <guid>/posts/2015/09/30/hello-world/</guid>
            <description>åˆ†äº«ä¸€ä¸ªç”Ÿæˆæ ‘çš„æ–¹æ³•
function list_to_tree($list, $pk=&amp;#39;id&amp;#39;, $pid = &amp;#39;pid&amp;#39;, $child = &amp;#39;_child&amp;#39;, $root = 0) { // åˆ›å»ºTree $tree = array(); if(is_array($list)) { // åˆ›å»ºåŸºäºä¸»é”®çš„æ•°ç»„å¼•ç”¨ $refer = array(); foreach ($list as $key =&amp;gt; $data) { $refer[$data[$pk]] =&amp;amp; $list[$key]; } foreach ($list as $key =&amp;gt; $data) { // åˆ¤æ–­æ˜¯å¦å­˜åœ¨parent $parentId = $data[$pid]; if ($root == $parentId) { $tree[] =&amp;amp; $list[$key]; }else{ if (isset($refer[$parentId])) { $parent =&amp;amp; $refer[$parentId]; $parent[$child][] =&amp;amp; $list[$key]; } } } } return $tree; }</description>
            <content type="html"><![CDATA[<p><code>åˆ†äº«ä¸€ä¸ªç”Ÿæˆæ ‘çš„æ–¹æ³•</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">function list_to_tree($list, $pk=&#39;id&#39;, $pid = &#39;pid&#39;, $child = &#39;_child&#39;, $root = 0) {
	// åˆ›å»ºTree
	$tree = array();
	if(is_array($list)) {
    	// åˆ›å»ºåŸºäºä¸»é”®çš„æ•°ç»„å¼•ç”¨
        $refer = array();
        foreach ($list as $key =&gt; $data) {
            $refer[$data[$pk]] =<span style="color:#960050;background-color:#1e0010">&amp;</span> $list[$key];
        }
        foreach ($list as $key =&gt; $data) {
            // åˆ¤æ–­æ˜¯å¦å­˜åœ¨parent
            $parentId =  $data[$pid];
            if ($root == $parentId) {
                $tree[] =<span style="color:#960050;background-color:#1e0010">&amp;</span> $list[$key];
            }else{
                if (isset($refer[$parentId])) {
                    $parent =<span style="color:#960050;background-color:#1e0010">&amp;</span> $refer[$parentId];
                    $parent[$child][] =<span style="color:#960050;background-color:#1e0010">&amp;</span> $list[$key];
                }
            }
        }
    }
    return $tree;
}</code></pre></div>]]></content>
        </item>
        
    </channel>
</rss>
